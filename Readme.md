ğŸ¯ ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®éœ€æ±‚ï¼ˆä¿å­˜äºéœ€æ±‚æ–‡æ¡£ï¼‰
1.1 é¡¹ç›®æ¦‚è¿°
é¡¹ç›®èƒŒæ™¯
éšç€ä¸ªäººè´¢åŠ¡ç®¡ç†éœ€æ±‚çš„å¢é•¿ï¼Œå¸‚åœºä¸Šç¼ºä¹æ™ºèƒ½åŒ–ã€æ˜“ç”¨æ€§å¼ºçš„è®°è´¦å·¥å…·ã€‚æœ¬é¡¹ç›®æ—¨åœ¨é€šè¿‡AIæŠ€æœ¯è§£å†³ä¼ ç»Ÿè®°è´¦ç¹çã€åˆ†æä¸è¶³çš„é—®é¢˜ã€‚

æ ¸å¿ƒç›®æ ‡
æ™ºèƒ½è®°è´¦ï¼šé™ä½è®°è´¦é—¨æ§›ï¼Œæé«˜è®°è´¦æ•ˆç‡
æ·±åº¦åˆ†æï¼šæä¾›æœ‰ä»·å€¼çš„è´¢åŠ¡æ´å¯Ÿå’Œå»ºè®®
ä¸ªæ€§åŒ–ä½“éªŒï¼šé€‚åº”ä¸åŒç”¨æˆ·çš„è´¢åŠ¡ä¹ æƒ¯å’Œéœ€æ±‚
æ•°æ®å®‰å…¨ï¼šç¡®ä¿ç”¨æˆ·è´¢åŠ¡æ•°æ®çš„éšç§å’Œå®‰å…¨

ç›®æ ‡ç”¨æˆ·ç”»åƒ
ç”¨æˆ·ç±»å‹	å æ¯”	æ ¸å¿ƒç—›ç‚¹	æœŸæœ›åŠŸèƒ½
èŒåœºæ–°äºº	35%	æœˆå…‰æ—ï¼Œæ¶ˆè´¹æ— è®¡åˆ’	é¢„ç®—æ§åˆ¶ï¼Œæ¶ˆè´¹æé†’
å®¶åº­ä¸»å¦‡	25%	å®¶åº­å¼€æ”¯å¤æ‚éš¾ç®¡ç†	å¤šäººè®°è´¦ï¼Œåˆ†ç±»ç»Ÿè®¡
è‡ªç”±èŒä¸šè€…	20%	æ”¶å…¥ä¸ç¨³å®šï¼Œç¨åŠ¡å¤æ‚	æ”¶å…¥è¿½è¸ªï¼Œç¨åŠ¡ç»Ÿè®¡
ç†è´¢çˆ±å¥½è€…	20%	éœ€è¦æ·±åº¦åˆ†æå·¥å…·	æŠ•èµ„è¿½è¸ªï¼Œè¶‹åŠ¿åˆ†æ
1.2 åŠŸèƒ½éœ€æ±‚è¯¦è¿°
æ¨¡å—1ï¼šç”¨æˆ·ç³»ç»Ÿ
åŠŸèƒ½æ¸…å•ï¼š
æ³¨å†Œä¸ç™»å½•
é‚®ç®±/æ‰‹æœºå·æ³¨å†Œ
ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ï¼‰
å¿˜è®°å¯†ç 
å¤šè®¾å¤‡ç™»å½•ç®¡ç†
ç”¨æˆ·é…ç½®
ä¸ªäººèµ„æ–™è®¾ç½®
åå¥½è®¾ç½®ï¼ˆå¸ç§ã€æ—¶åŒºã€è¯­è¨€ï¼‰
é€šçŸ¥åå¥½
æ•°æ®å¤‡ä»½è®¾ç½®
éªŒæ”¶æ ‡å‡†ï¼š
æ³¨å†Œæµç¨‹ä¸è¶…è¿‡3æ­¥
ç™»å½•å“åº”æ—¶é—´<2ç§’
æ”¯æŒåŒæ—¶åœ¨çº¿è®¾å¤‡ç®¡ç†
æ¨¡å—2ï¼šæ ¸å¿ƒè®°è´¦åŠŸèƒ½
åŠŸèƒ½æ¸…å•ï¼š
å¿«é€Ÿè®°è´¦
é‡‘é¢è¾“å…¥ï¼ˆæ”¯æŒå¤šç§è´§å¸ï¼‰
åˆ†ç±»é€‰æ‹©ï¼ˆå¤šçº§åˆ†ç±»ï¼‰
è´¦æˆ·é€‰æ‹©
æ—¶é—´é€‰æ‹©ï¼ˆé»˜è®¤å½“å‰æ—¶é—´ï¼‰
å¤‡æ³¨å’Œæ ‡ç­¾
é«˜çº§è®°è´¦
å‘¨æœŸè´¦å•ï¼ˆæ¯æœˆè‡ªåŠ¨ç”Ÿæˆï¼‰
è½¬è´¦è®°å½•ï¼ˆè´¦æˆ·é—´èµ„é‡‘æµåŠ¨ï¼‰
å€Ÿè´·ç®¡ç†ï¼ˆå€Ÿå…¥/å€Ÿå‡ºï¼‰
æŠ•èµ„è®°å½•ï¼ˆè‚¡ç¥¨ã€åŸºé‡‘ï¼‰
éªŒæ”¶æ ‡å‡†ï¼š
å•ç¬”è®°è´¦æ“ä½œ<30ç§’å®Œæˆ
æ”¯æŒæ‰¹é‡æ“ä½œï¼ˆæœ€å¤š100æ¡ï¼‰
æ•°æ®å®æ—¶åŒæ­¥
æ¨¡å—3ï¼šè´¦æˆ·ç®¡ç†
è´¦æˆ·ç±»å‹æ”¯æŒï¼š
è´¦æˆ·ç±»å‹	å±æ€§	æ”¯æŒæ“ä½œ
ç°é‡‘è´¦æˆ·	ä½™é¢ã€å¸ç§	æ”¶å…¥ã€æ”¯å‡ºã€è½¬è´¦
é“¶è¡Œè´¦æˆ·	å¡å·ã€é“¶è¡Œã€ä½™é¢	åŒä¸Šï¼Œæ”¯æŒå¯¹è´¦
ä¿¡ç”¨å¡	å¡å·ã€é“¶è¡Œã€è´¦å•æ—¥ã€è¿˜æ¬¾æ—¥	æ¶ˆè´¹ã€è¿˜æ¬¾ã€åˆ†æœŸ
ç”µå­é’±åŒ…	å¹³å°ã€ä½™é¢	æ”¯ä»˜ã€æç°
æŠ•èµ„è´¦æˆ·	ç±»å‹ã€å¸‚å€¼	ä¹°å…¥ã€å–å‡ºã€åˆ†çº¢
è´Ÿå€ºè´¦æˆ·	è´·æ¬¾æ–¹ã€åˆ©ç‡ã€æœŸé™	å€Ÿæ¬¾ã€è¿˜æ¬¾
æ¨¡å—4ï¼šé¢„ç®—ç®¡ç†
é¢„ç®—ç»´åº¦ï¼š
æ—¶é—´ç»´åº¦
æ—¥é¢„ç®—
å‘¨é¢„ç®—
æœˆé¢„ç®—
å¹´é¢„ç®—
è‡ªå®šä¹‰å‘¨æœŸ
åˆ†ç±»ç»´åº¦
æŒ‰æ¶ˆè´¹åˆ†ç±»
æŒ‰è´¦æˆ·
æŒ‰æ ‡ç­¾
é¢„ç®—æé†’
é¢„ç®—ä½¿ç”¨ç‡æé†’ï¼ˆ50%ã€80%ã€90%ã€100%ï¼‰
é¢„ç®—è¶…æ”¯æé†’
é¢„ç®—è°ƒæ•´å»ºè®®
æ¨¡å—5ï¼šæ•°æ®åˆ†æ
åˆ†ææŠ¥å‘Šç±»å‹ï¼š
æ—¥æŠ¥
å½“æ—¥æ”¶æ”¯æ±‡æ€»
ä¸»è¦æ¶ˆè´¹ç±»åˆ«
ä¸æ˜¨æ—¥å¯¹æ¯”
æœˆæŠ¥
æœˆåº¦æ”¶æ”¯åˆ†æ
æ¶ˆè´¹è¶‹åŠ¿å›¾
é¢„ç®—æ‰§è¡Œæƒ…å†µ
å‚¨è“„ç‡åˆ†æ
å¹´æŠ¥
å¹´åº¦è´¢åŠ¡æ€»ç»“
æ”¶å…¥å¢é•¿åˆ†æ
æ¶ˆè´¹ä¹ æƒ¯å˜åŒ–
æŠ•èµ„å›æŠ¥ç‡
ä¸“é¡¹åˆ†æ
é¤é¥®æ¶ˆè´¹åˆ†æ
äº¤é€šè´¹ç”¨åˆ†æ
å¨±ä¹æ”¯å‡ºåˆ†æ
æŠ•èµ„ç»„åˆåˆ†æ
æ¨¡å—6ï¼šAIå¢å¼ºåŠŸèƒ½
æ™ºèƒ½åŠŸèƒ½æ¸…å•ï¼š
æ™ºèƒ½åˆ†ç±»
è‡ªåŠ¨è¯†åˆ«äº¤æ˜“ç±»å‹
å­¦ä¹ ç”¨æˆ·åˆ†ç±»ä¹ æƒ¯
æ”¯æŒæ‰‹åŠ¨ä¿®æ­£å¹¶å­¦ä¹ 
è¯­éŸ³è®°è´¦
è¯­éŸ³è¾“å…¥è½¬æ–‡å­—
è¯­éŸ³æŒ‡ä»¤è¯†åˆ«
å¤šè¯­è¨€æ”¯æŒ
å›¾ç‰‡è¯†åˆ«
ç¥¨æ®ç…§ç‰‡è¯†åˆ«
æˆªå›¾è´¦å•è¯†åˆ«
è´­ç‰©å°ç¥¨è¯†åˆ«
æ™ºèƒ½é—®ç­”
è‡ªç„¶è¯­è¨€æŸ¥è¯¢
è´¢åŠ¡å»ºè®®ç”Ÿæˆ
è¶‹åŠ¿é¢„æµ‹

1.3 éåŠŸèƒ½æ€§éœ€æ±‚
æ€§èƒ½éœ€æ±‚
æŒ‡æ ‡	ç›®æ ‡å€¼	æµ‹é‡æ–¹æ³•
é¡µé¢åŠ è½½æ—¶é—´	<2ç§’	Lighthouseæµ‹è¯•
APIå“åº”æ—¶é—´	<500ms	APMç›‘æ§
æ•°æ®åŒæ­¥å»¶è¿Ÿ	<1ç§’	ç«¯åˆ°ç«¯æµ‹è¯•
å¹¶å‘ç”¨æˆ·æ•°	10,000+	å‹åŠ›æµ‹è¯•
å®‰å…¨éœ€æ±‚
æ•°æ®åŠ å¯†
ä¼ è¾“å±‚ï¼šTLS 1.3
å­˜å‚¨å±‚ï¼šAES-256åŠ å¯†
æ•°æ®åº“ï¼šå­—æ®µçº§åŠ å¯†
éšç§ä¿æŠ¤
GDPRåˆè§„
æ•°æ®æœ€å°åŒ–åŸåˆ™
ç”¨æˆ·æ•°æ®åˆ é™¤åŠŸèƒ½
è®¿é—®æ§åˆ¶
è§’è‰²æƒé™ç®¡ç†
APIè®¿é—®é¢‘ç‡é™åˆ¶
å¼‚å¸¸ç™»å½•æ£€æµ‹
å¯ç”¨æ€§éœ€æ±‚
å¯è®¿é—®æ€§
WCAG 2.1 AAæ ‡å‡†
å±å¹•é˜…è¯»å™¨æ”¯æŒ
é”®ç›˜å¯¼èˆªæ”¯æŒ
è·¨å¹³å°å…¼å®¹æ€§
Webï¼šChromeã€Safariã€Firefoxæœ€æ–°ç‰ˆ
ç§»åŠ¨ç«¯ï¼šiOS 13+ã€Android 8+
å“åº”å¼è®¾è®¡
å›½é™…åŒ–
å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­ã€è‹±ã€æ—¥ã€éŸ©ï¼‰
æœ¬åœ°åŒ–æ ¼å¼ï¼ˆæ—¥æœŸã€è´§å¸ï¼‰
RTLè¯­è¨€æ”¯æŒ

å®Œå–„çš„é¡¹ç›®åˆå§‹åŒ–AIæŒ‡ä»¤
ğŸš€ Cursor AIæŒ‡ä»¤ï¼šé¡¹ç›®åˆå§‹åŒ–
é¡¹ç›®æ¦‚å†µ
æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªåä¸º"æ™ºèƒ½è®°è´¦åŠ©æ‰‹"çš„ä¸ªäººè´¢åŠ¡ç®¡ç†åº”ç”¨ï¼Œéœ€è¦åˆ›å»ºå®Œæ•´çš„é¡¹ç›®è„šæ‰‹æ¶ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆå’Œå¾®æœåŠ¡æ¶æ„ã€‚

æŠ€æœ¯æ ˆè¦æ±‚
yaml
æ ¸å¿ƒæ¶æ„: "å‰åç«¯åˆ†ç¦» + å¾®æœåŠ¡"
å¼€å‘æ¨¡å¼: "åŸºäºDockerçš„å¼€å‘ç¯å¢ƒ"

å‰ç«¯æŠ€æœ¯æ ˆ:
  - æ¡†æ¶: "React 18 + TypeScript"
  - æ„å»ºå·¥å…·: "Vite 5"
  - UIåº“: "Ant Design 5.x"
  - çŠ¶æ€ç®¡ç†: "Redux Toolkit + RTK Query"
  - å›¾è¡¨: "ECharts 5"
  - è·¯ç”±: "React Router 6"
  - HTTPå®¢æˆ·ç«¯: "Axios"
  - å·¥å…·åº“: "dayjs, lodash-es"
  - CSSæ–¹æ¡ˆ: "Styled Components + Ant Design Token System"
  - ä»£ç è§„èŒƒ: "ESLint + Prettier + Airbnb TypeScriptè§„èŒƒ"

åç«¯æŠ€æœ¯æ ˆ:
  - æ¡†æ¶: "NestJS 10 + TypeScript"
  - ORM: "Prisma 5"
  - æ•°æ®åº“: "PostgreSQL 15 + Redis 7"
  - è®¤è¯: "JWT + Passport"
  - éªŒè¯: "class-validator + class-transformer"
  - APIæ–‡æ¡£: "Swagger/OpenAPI 3"
  - æ–‡ä»¶å­˜å‚¨: "Multer + MinIO"
  - ä»»åŠ¡é˜Ÿåˆ—: "BullMQ (Redis)"
  - ç¼“å­˜: "Redis + å†…å­˜ç¼“å­˜"
  - ç›‘æ§: "NestJSå†…ç½®ç›‘æ§ + è‡ªå®šä¹‰æŒ‡æ ‡"
  - æ—¥å¿—: "Winston + ELKæ ¼å¼"

AIæœåŠ¡æ ˆ:
  - ä¸»è¦AI: "DeepSeek API (æ·±åº¦æ±‚ç´¢)"
  - å¤‡ç”¨AI: "OpenAIå…¼å®¹æ¥å£"
  - è¯­éŸ³è¯†åˆ«: "Web Speech API + å¤‡é€‰æœåŠ¡"
  - OCRè¯†åˆ«: "Tesseract.js + è‡ªå®šä¹‰æ¨¡å‹"
  - å‘é‡æ•°æ®åº“: "å¯é€‰Pinecone/Supabase"
  - æœ¬åœ°AI: "å¯é€‰Ollama (æœ¬åœ°éƒ¨ç½²)"

ç§»åŠ¨ç«¯æŠ€æœ¯æ ˆ:
  - æ¡†æ¶: "React Native 0.72+"
  - å¯¼èˆª: "React Navigation 6"
  - UIåº“: "React Native Paper + è‡ªå®šä¹‰ç»„ä»¶"
  - çŠ¶æ€ç®¡ç†: "Zustand (è½»é‡çº§)"
  - å­˜å‚¨: "AsyncStorage + MMKV"
  - ç¦»çº¿æ”¯æŒ: "WatermelonDB (å¯é€‰)"

åŸºç¡€è®¾æ–½:
  - å®¹å™¨åŒ–: "Docker + Docker Compose"
  - å¼€å‘ç¯å¢ƒ: "Dev Containers (VS Code)"
  - æœ¬åœ°ç½‘ç»œ: "Traefikåå‘ä»£ç†"
  - æ•°æ®åº“ç®¡ç†: "PgAdmin 7 + Redis Insight"
  - æ–‡ä»¶å­˜å‚¨: "MinIOæ§åˆ¶å°"
  - æµ‹è¯•ç¯å¢ƒ: "Jest + Supertest + Cypress"
  - CI/CD: "GitHub Actionsæ¨¡æ¿"
é¡¹ç›®ç»“æ„è§„èŒƒ
text
smart-finance-assistant/                    # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ ğŸ“ .github/                            # GitHubé…ç½®
â”‚   â”œâ”€â”€ ğŸ“ workflows/                      # CI/CDæµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ ci.yml                        # æŒç»­é›†æˆ
â”‚   â”‚   â”œâ”€â”€ cd.yml                        # æŒç»­éƒ¨ç½²
â”‚   â”‚   â””â”€â”€ security-scan.yml            # å®‰å…¨æ‰«æ
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md          # PRæ¨¡æ¿
â”‚
â”œâ”€â”€ ğŸ“ .vscode/                           # VS Codeé…ç½®
â”‚   â”œâ”€â”€ extensions.json                   # æ¨èæ‰©å±•
â”‚   â”œâ”€â”€ settings.json                     # é¡¹ç›®è®¾ç½®
â”‚   â””â”€â”€ devcontainer.json                 # å¼€å‘å®¹å™¨é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ client/                            # å‰ç«¯Webåº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“ public/                        # é™æ€èµ„æº
â”‚   â”œâ”€â”€ ğŸ“ src/                           # æºç ç›®å½•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/                       # APIè°ƒç”¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ axios.config.ts          # Axiosé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ services/                # APIæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ interceptors/            # æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“ assets/                    # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/                # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ common/               # åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/                   # UIç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ forms/                # è¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ features/                  # åŠŸèƒ½æ¨¡å—ï¼ˆåŸºäºä¸šåŠ¡ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/                 # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ dashboard/            # ä»ªè¡¨æ¿æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ transactions/         # äº¤æ˜“æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ accounts/             # è´¦æˆ·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ categories/           # åˆ†ç±»æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ budgets/              # é¢„ç®—æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ reports/              # æŠ¥è¡¨æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ ai-assistant/         # AIåŠ©æ‰‹æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ settings/             # è®¾ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ ğŸ“ hooks/                     # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ ğŸ“ lib/                       # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ ğŸ“ locales/                   # å›½é™…åŒ–
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pages/                     # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ router/                    # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ store/                     # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ slices/                   # Reduxåˆ‡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks.ts                  # Redux Hooks
â”‚   â”‚   â”‚   â””â”€â”€ index.ts                  # Storeé…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ styles/                    # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ themes/                   # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ global.css                # å…¨å±€æ ·å¼
â”‚   â”‚   â”‚   â””â”€â”€ antd.variables.less       # Ant Designå˜é‡
â”‚   â”‚   â”œâ”€â”€ ğŸ“ types/                     # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ api.types.ts              # APIç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ domain.types.ts           # é¢†åŸŸç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ global.d.ts               # å…¨å±€ç±»å‹
â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ date.ts                   # æ—¥æœŸå·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ format.ts                 # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ validation.ts             # éªŒè¯å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ index.ts                  # å·¥å…·å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ App.tsx                       # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ main.tsx                      # å…¥å£æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ vite-env.d.ts                 # Viteç¯å¢ƒç±»å‹
â”‚   â”œâ”€â”€ .env.example                      # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”œâ”€â”€ .eslintrc.js                      # ESLinté…ç½®
â”‚   â”œâ”€â”€ .prettierrc                       # Prettieré…ç½®
â”‚   â”œâ”€â”€ index.html                        # HTMLå…¥å£
â”‚   â”œâ”€â”€ package.json                      # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json                     # TypeScripté…ç½®
â”‚   â”œâ”€â”€ tsconfig.node.json                # Node TSé…ç½®
â”‚   â””â”€â”€ vite.config.ts                    # Viteé…ç½®
â”‚
â”œâ”€â”€ ğŸ“ server/                            # åç«¯APIæœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ prisma/                        # Prismaé…ç½®
â”‚   â”‚   â”œâ”€â”€ schema.prisma                 # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ migrations/                   # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ seed.ts                       # ç§å­æ•°æ®
â”‚   â”œâ”€â”€ ğŸ“ src/                           # æºç ç›®å½•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ common/                    # é€šç”¨æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ decorators/           # è‡ªå®šä¹‰è£…é¥°å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ filters/              # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ guards/               # å®ˆå«
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ interceptors/         # æ‹¦æˆªå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ middleware/           # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ pipes/                # ç®¡é“
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ ğŸ“ config/                    # é…ç½®æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ app.config.ts             # åº”ç”¨é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.config.ts        # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ redis.config.ts           # Redisé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.config.ts             # JWTé…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ upload.config.ts          # ä¸Šä¼ é…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ core/                      # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.ts              # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/               # å¼‚å¸¸å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ types/                    # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“ modules/                   # ä¸šåŠ¡æ¨¡å—ï¼ˆæ¯ä¸ªæ¨¡å—ç‹¬ç«‹ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/                  # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                  # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ entities/             # å®ä½“å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ guards/               # å®ˆå«
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ strategies/           # ç­–ç•¥
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts    # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.module.ts        # æ¨¡å—å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts       # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth.interface.ts     # æ¥å£å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ users/                 # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ accounts/              # è´¦æˆ·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ transactions/          # äº¤æ˜“æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ categories/            # åˆ†ç±»æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ budgets/               # é¢„ç®—æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ bills/                 # è´¦å•æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ reports/               # æŠ¥è¡¨æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ ai/                    # AIæœåŠ¡æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ health/                # å¥åº·æ£€æŸ¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ ğŸ“ shared/                    # å…±äº«æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ database/              # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ redis/                 # Redisç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ utils/                 # å…±äº«å·¥å…·
â”‚   â”‚   â”œâ”€â”€ app.module.ts                 # æ ¹æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ main.ts                       # å…¥å£æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ bootstrap.ts                  # å¯åŠ¨é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ test/                          # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ e2e/                          # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ integration/                  # é›†æˆæµ‹è¯•
â”‚   â”‚   â””â”€â”€ unit/                         # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ .env.example                      # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”œâ”€â”€ .eslintrc.js                      # ESLinté…ç½®
â”‚   â”œâ”€â”€ .prettierrc                       # Prettieré…ç½®
â”‚   â”œâ”€â”€ dockerfile                        # Dockeræ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ nest-cli.json                     # NestJS CLIé…ç½®
â”‚   â”œâ”€â”€ package.json                      # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.build.json               # æ„å»ºé…ç½®
â”‚   â”œâ”€â”€ tsconfig.json                     # TypeScripté…ç½®
â”‚   â””â”€â”€ webpack.config.js                 # Webpacké…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ mobile/                            # ç§»åŠ¨ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“ android/                       # AndroidåŸç”Ÿä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ ios/                           # iOSåŸç”Ÿä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ src/                           # React Nativeæºç 
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/                # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ screens/                   # å±å¹•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ navigation/                # å¯¼èˆª
â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/                  # æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ğŸ“ store/                     # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ ğŸ“ types/                     # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ App.tsx                       # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.js                      # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ .env.example                      # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”œâ”€â”€ app.json                          # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ babel.config.js                   # Babelé…ç½®
â”‚   â”œâ”€â”€ metro.config.js                   # Metroé…ç½®
â”‚   â””â”€â”€ package.json                      # ä¾èµ–é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ ai-services/                       # AIå¾®æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ classification/                # åˆ†ç±»æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ğŸ“ src/                       # æºç 
â”‚   â”‚   â”œâ”€â”€ ğŸ“ tests/                     # æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ dockerfile                    # Dockeré…ç½®
â”‚   â”‚   â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â”‚   â”‚   â””â”€â”€ main.py                       # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ ocr/                           # OCRè¯†åˆ«æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ speech/                        # è¯­éŸ³è¯†åˆ«æœåŠ¡
â”‚   â””â”€â”€ ğŸ“ analysis/                      # åˆ†ææœåŠ¡
â”‚
â”œâ”€â”€ ğŸ“ infrastructure/                    # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ ğŸ“ docker/                        # Dockeré…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ postgres/                  # PostgreSQLé…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ redis/                     # Redisé…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ minio/                     # MinIOé…ç½®
â”‚   â”‚   â””â”€â”€ ğŸ“ traefik/                   # Traefiké…ç½®
â”‚   â”œâ”€â”€ ğŸ“ k8s/                           # Kubernetesé…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ base/                      # åŸºç¡€é…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ overlays/                  # ç¯å¢ƒè¦†ç›–
â”‚   â”‚   â””â”€â”€ kustomization.yaml            # Kustomizeé…ç½®
â”‚   â”œâ”€â”€ ğŸ“ monitoring/                    # ç›‘æ§é…ç½®
â”‚   â”‚   â”œâ”€â”€ prometheus.yml                # Prometheusé…ç½®
â”‚   â”‚   â”œâ”€â”€ grafana-dashboards/           # Grafanaé¢æ¿
â”‚   â”‚   â””â”€â”€ alerts/                       # å‘Šè­¦è§„åˆ™
â”‚   â”œâ”€â”€ ğŸ“ scripts/                       # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ docker-compose.yml                # Docker Composeå¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ docker-compose.prod.yml           # Docker Composeç”Ÿäº§ç¯å¢ƒ
â”‚   â””â”€â”€ Makefile                          # éƒ¨ç½²å‘½ä»¤
â”‚
â”œâ”€â”€ ğŸ“ docs/                              # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ api/                           # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ architecture/                  # æ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ database/                      # æ•°æ®åº“æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ deployment/                    # éƒ¨ç½²æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ development/                   # å¼€å‘æ–‡æ¡£
â”‚   â””â”€â”€ ğŸ“ user-guide/                    # ç”¨æˆ·æŒ‡å—
â”‚
â”œâ”€â”€ ğŸ“ packages/                          # å…±äº«åŒ…ï¼ˆMonorepoå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ shared-types/                  # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ğŸ“ ui-components/                 # å…±äº«UIç»„ä»¶
â”‚   â””â”€â”€ ğŸ“ utils/                         # å…±äº«å·¥å…·
â”‚
â”œâ”€â”€ .cursorrules                          # Cursor AIé¡¹ç›®è§„åˆ™
â”œâ”€â”€ .cz-config.js                         # Commitizené…ç½®
â”œâ”€â”€ .editorconfig                         # ç¼–è¾‘å™¨é…ç½®
â”œâ”€â”€ .env.example                          # å…¨å±€ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .eslintrc.js                          # æ ¹ESLinté…ç½®
â”œâ”€â”€ .gitattributes                        # Gitå±æ€§
â”œâ”€â”€ .gitignore                            # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .husky/                               # Gité’©å­
â”‚   â”œâ”€â”€ pre-commit                        # æäº¤å‰æ£€æŸ¥
â”‚   â”œâ”€â”€ commit-msg                        # æäº¤ä¿¡æ¯æ£€æŸ¥
â”‚   â””â”€â”€ _/                                # é’©å­è„šæœ¬
â”œâ”€â”€ .prettierignore                       # Prettierå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .prettierrc                           # æ ¹Prettieré…ç½®
â”œâ”€â”€ .nvmrc                                # Nodeç‰ˆæœ¬æ§åˆ¶
â”œâ”€â”€ .dockerignore                         # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ commitlint.config.js                  # Commitlinté…ç½®
â”œâ”€â”€ LICENSE                               # å¼€æºè®¸å¯è¯
â”œâ”€â”€ Makefile                              # é¡¹ç›®å‘½ä»¤
â”œâ”€â”€ package.json                          # æ ¹package.jsonï¼ˆworkspaceé…ç½®ï¼‰
â”œâ”€â”€ pnpm-workspace.yaml                   # pnpm workspaceé…ç½®
â”œâ”€â”€ README.md                             # é¡¹ç›®è¯´æ˜
â””â”€â”€ turbo.json                            # Turborepoé…ç½®ï¼ˆå¦‚æœä½¿ç”¨Monorepoï¼‰
ä»»åŠ¡æ¸…å•ï¼ˆè¯¦ç»†ç‰ˆï¼‰
é˜¶æ®µ1ï¼šé¡¹ç›®åŸºç¡€é…ç½®
åˆ›å»ºé¡¹ç›®éª¨æ¶

æŒ‰ç…§ä¸Šè¿°ç»“æ„åˆ›å»ºæ‰€æœ‰ç›®å½•

åˆå§‹åŒ–Gitä»“åº“ï¼ˆåŒ…å«åˆç†çš„.gitignoreï¼‰

è®¾ç½®Monorepoå·¥ä½œåŒºï¼ˆæ¨èpnpm workspaceï¼‰

é…ç½®å¼€å‘ç¯å¢ƒ

Dockerå¼€å‘ç¯å¢ƒï¼ˆdocker-compose.ymlï¼‰

VS Codeå¼€å‘å®¹å™¨é…ç½®

è®¾ç½®å¼€å‘è„šæœ¬ï¼ˆMakefileæˆ–package.json scriptsï¼‰

é…ç½®ä»£ç è§„èŒƒ

ESLinté…ç½®ï¼ˆAirbnb TypeScriptè§„èŒƒï¼‰

Prettieré…ç½®ï¼ˆç»Ÿä¸€ä»£ç é£æ ¼ï¼‰

EditorConfigï¼ˆç¼–è¾‘å™¨ç»Ÿä¸€ï¼‰

Gité’©å­ï¼ˆHusky + lint-stagedï¼‰

é…ç½®æäº¤è§„èŒƒ

Commitizené…ç½®

Commitlinté…ç½®

ç”Ÿæˆæ ‡å‡†çš„CHANGELOG

é˜¶æ®µ2ï¼šå‰ç«¯åˆå§‹åŒ–
React + TypeScript + Viteé…ç½®

åˆ›å»ºViteé¡¹ç›®æ¨¡æ¿

é…ç½®TypeScriptè·¯å¾„åˆ«å

è®¾ç½®ç¯å¢ƒå˜é‡ç®¡ç†

UIå’Œæ ·å¼é…ç½®

é›†æˆAnt Design 5.x

é…ç½®ä¸»é¢˜å®šåˆ¶

è®¾ç½®Styled Components

é…ç½®CSSæ¨¡å—åŒ–

çŠ¶æ€ç®¡ç†å’Œè·¯ç”±

é…ç½®Redux Toolkit + RTK Query

è®¾ç½®React Router 6

åˆ›å»ºåº”ç”¨çŠ¶æ€ç®¡ç†ç»“æ„

å·¥å…·å‡½æ•°å’Œç±»å‹å®šä¹‰

åˆ›å»ºå¸¸ç”¨å·¥å…·å‡½æ•°ï¼ˆæ—¥æœŸã€æ ¼å¼åŒ–ã€éªŒè¯ï¼‰

å®šä¹‰TypeScriptç±»å‹ï¼ˆAPIå“åº”ã€å®ä½“ï¼‰

é…ç½®å›½é™…åŒ–ï¼ˆi18nextï¼‰

é˜¶æ®µ3ï¼šåç«¯åˆå§‹åŒ–
NestJSé¡¹ç›®é…ç½®

åˆ›å»ºNestJSé¡¹ç›®ç»“æ„

é…ç½®æ¨¡å—åŒ–æ¶æ„

è®¾ç½®ç¯å¢ƒå˜é‡ç®¡ç†

æ•°æ®åº“é…ç½®

Prisma Schemaè®¾è®¡ï¼ˆåŸºäºå®Œæ•´éœ€æ±‚æ–‡æ¡£ï¼‰

æ•°æ®åº“è¿æ¥é…ç½®

Redisè¿æ¥é…ç½®

æ•°æ®è¿ç§»è„šæœ¬

æ ¸å¿ƒæ¨¡å—åˆ›å»º

è®¤è¯æ¨¡å—ï¼ˆJWT + Passportï¼‰

ç”¨æˆ·ç®¡ç†æ¨¡å—

é€šç”¨å¼‚å¸¸å¤„ç†

è¯·æ±‚éªŒè¯ç®¡é“

APIå’Œæ–‡æ¡£

RESTful APIè®¾è®¡è§„èŒƒ

Swagger/OpenAPIæ–‡æ¡£ç”Ÿæˆ

è¯·æ±‚/å“åº”DTOå®šä¹‰

é˜¶æ®µ4ï¼šåŸºç¡€è®¾æ–½é…ç½®
Dockerå¼€å‘ç¯å¢ƒ

PostgreSQLå®¹å™¨é…ç½®

Rediså®¹å™¨é…ç½®

MinIOæ–‡ä»¶å­˜å‚¨é…ç½®

åå‘ä»£ç†é…ç½®ï¼ˆTraefikï¼‰

ç›‘æ§å’Œæ—¥å¿—

Winstonæ—¥å¿—é…ç½®

åº”ç”¨æ€§èƒ½ç›‘æ§

å¥åº·æ£€æŸ¥ç«¯ç‚¹

æµ‹è¯•ç¯å¢ƒ

Jestå•å…ƒæµ‹è¯•é…ç½®

E2Eæµ‹è¯•é…ç½®ï¼ˆCypressï¼‰

æµ‹è¯•æ•°æ®å·¥å‚

é˜¶æ®µ5ï¼šå¼€å‘å·¥å…·é…ç½®
è°ƒè¯•é…ç½®

VS Codeè°ƒè¯•é…ç½®

æµè§ˆå™¨å¼€å‘è€…å·¥å…·é›†æˆ

APIè°ƒè¯•å·¥å…·ï¼ˆThunder Client/Postmané›†åˆï¼‰

è„šæœ¬å·¥å…·

æ•°æ®åº“é‡ç½®è„šæœ¬

æ•°æ®ç§å­è„šæœ¬

å¤‡ä»½/æ¢å¤è„šæœ¬

å…·ä½“å®æ–½è¦æ±‚
1. ç¯å¢ƒå˜é‡é…ç½®
bash
# .env.example åº”è¯¥åŒ…å«ï¼š
# å‰ç«¯ç¯å¢ƒå˜é‡
VITE_API_URL=http://localhost:3000/api/v1
VITE_WS_URL=ws://localhost:3000
VITE_APP_NAME=æ™ºèƒ½è®°è´¦åŠ©æ‰‹
VITE_ENABLE_AI=true

# åç«¯ç¯å¢ƒå˜é‡
NODE_ENV=development
PORT=3000
DATABASE_URL=postgresql://user:password@localhost:5432/smart_finance
REDIS_URL=redis://localhost:6379
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d
DEEPSEEK_API_KEY=your-deepseek-api-key
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=password
MINIO_BUCKET=smart-finance
2. package.json ä¾èµ–è¦æ±‚
å‰ç«¯ä¾èµ–ç¤ºä¾‹ï¼š

json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "@reduxjs/toolkit": "^1.9.7",
    "react-redux": "^8.1.3",
    "@ant-design/icons": "^5.2.6",
    "antd": "^5.12.1",
    "styled-components": "^6.1.1",
    "axios": "^1.6.2",
    "echarts": "^5.4.3",
    "echarts-for-react": "^3.0.2",
    "dayjs": "^1.11.10",
    "lodash-es": "^4.17.21",
    "i18next": "^23.7.6",
    "react-i18next": "^13.3.1"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@typescript-eslint/eslint-plugin": "^6.14.0",
    "@typescript-eslint/parser": "^6.14.0",
    "@vitejs/plugin-react": "^4.2.0",
    "eslint": "^8.55.0",
    "eslint-config-airbnb-typescript": "^17.1.0",
    "eslint-plugin-import": "^2.29.0",
    "eslint-plugin-jsx-a11y": "^6.8.0",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "prettier": "^3.1.1",
    "typescript": "^5.3.3",
    "vite": "^5.0.8"
  }
}
3. Docker Composeé…ç½®è¦æ±‚
yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
      POSTGRES_DB: smart_finance
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/docker/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes --requirepass redispass
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: password
    volumes:
      - minio_data:/data
    command: server /data --console-address ":9001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  backend:
    build:
      context: ./server
      dockerfile: Dockerfile.dev
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://admin:password@postgres:5432/smart_finance
      REDIS_URL: redis://:redispass@redis:6379
    ports:
      - "3000:3000"
    volumes:
      - ./server:/app
      - /app/node_modules
    command: npm run start:dev

  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile.dev
    ports:
      - "5173:5173"
    volumes:
      - ./client:/app
      - /app/node_modules
    environment:
      VITE_API_URL: http://localhost:3000/api/v1
    command: npm run dev

volumes:
  postgres_data:
  redis_data:
  minio_data:
4. Prisma Schemaè¦æ±‚
prisma
// åŸºäºå®Œæ•´éœ€æ±‚æ–‡æ¡£çš„Prisma Schema
// åŒ…å«æ‰€æœ‰è¡¨ã€å…³ç³»ã€ç´¢å¼•å’Œçº¦æŸ
// ä½¿ç”¨UUIDä½œä¸ºä¸»é”®
// åŒ…å«è½¯åˆ é™¤æ”¯æŒ
// åŒ…å«æ—¶é—´æˆ³å­—æ®µ
æœŸæœ›çš„è¾“å‡ºç»“æœ
æˆ‘éœ€è¦ä½ æä¾›ï¼š

å®Œæ•´çš„æ–‡ä»¶ç»“æ„æ ‘ï¼ˆå¦‚ä¸Šé¢æ‰€ç¤ºï¼‰

æ‰€æœ‰å…³é”®é…ç½®æ–‡ä»¶ï¼ˆpackage.json, .eslintrc.js, .prettierrcç­‰ï¼‰

Docker Composeé…ç½®æ–‡ä»¶ï¼ˆåŒ…å«æ‰€æœ‰æœåŠ¡ï¼‰

Prisma Schemaæ–‡ä»¶ï¼ˆåŸºäºå®Œæ•´éœ€æ±‚ï¼‰

åŸºç¡€æ¨¡å—ä»£ç ï¼ˆç”¨æˆ·è®¤è¯æ¨¡å—çš„å®Œæ•´å®ç°ï¼‰

å¼€å‘è„šæœ¬ï¼ˆMakefileæˆ–package.json scriptsï¼‰

ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆ.env.exampleï¼‰

ä»£ç è§„èŒƒé…ç½®ï¼ˆESLint, Prettier, EditorConfigï¼‰

ç‰¹åˆ«æ³¨æ„äº‹é¡¹
å®‰å…¨æ€§ï¼š

ç¯å¢ƒå˜é‡ç®¡ç†

JWTå¯†é’¥å®‰å…¨

APIå¯†é’¥ä¿æŠ¤

CORSé…ç½®

å¼€å‘ä½“éªŒï¼š

çƒ­é‡è½½é…ç½®

è°ƒè¯•é…ç½®

é”™è¯¯è¾¹ç•Œ

å¼€å‘å·¥å…·é›†æˆ

å¯æ‰©å±•æ€§ï¼š

æ¨¡å—åŒ–è®¾è®¡

æ’ä»¶æ¶æ„

é…ç½®é©±åŠ¨

ä¾èµ–æ³¨å…¥

æ€§èƒ½è€ƒè™‘ï¼š

æ•°æ®åº“ç´¢å¼•

ç¼“å­˜ç­–ç•¥

ä»£ç åˆ†å‰²

æ‡’åŠ è½½

é”™è¯¯å¤„ç†ï¼š

ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

å¼‚å¸¸è¿‡æ»¤å™¨

æ—¥å¿—è®°å½•

ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

è´¨é‡æ£€æŸ¥æ¸…å•
æ‰€æœ‰ç›®å½•ç»“æ„æ­£ç¡®åˆ›å»º

åŒ…ç®¡ç†å™¨é”å®šæ–‡ä»¶æ­£ç¡®ç”Ÿæˆ

TypeScripté…ç½®å®Œå¤‡

ESLintå’ŒPrettieré…ç½®æ­£ç¡®

Gité’©å­é…ç½®ç”Ÿæ•ˆ

Docker Composeèƒ½ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

æ•°æ®åº“è¿ç§»å¯ä»¥æ­£å¸¸è¿è¡Œ

å‰ç«¯å¯ä»¥æ­£å¸¸å¯åŠ¨

åç«¯å¯ä»¥æ­£å¸¸å¯åŠ¨

APIå¯ä»¥æ­£å¸¸è®¿é—®

ç”¨æˆ·è®¤è¯æµç¨‹å®Œæ•´

ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

æµ‹è¯•ç¯å¢ƒé…ç½®å®Œæˆ

ç›‘æ§å’Œæ—¥å¿—é…ç½®å®Œæˆ

è¯·æŒ‰ç…§ä¸Šè¿°è¦æ±‚ç”Ÿæˆå®Œæ•´çš„é¡¹ç›®åˆå§‹åŒ–ä»£ç å’Œé…ç½®ã€‚è¯·ç¡®ä¿ä»£ç è´¨é‡é«˜ï¼Œéµå¾ªæœ€ä½³å®è·µï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è¿è¡Œã€‚

ğŸ¯ Cursor AIæŒ‡ä»¤ï¼šå¼€å‘æ‰€æœ‰å¿…è¦çš„æ¨¡å—åŠŸèƒ½
1. åŠŸèƒ½åŸºæœ¬ä¿¡æ¯
åŠŸèƒ½åç§°ï¼š
[ä¸­æ–‡åŠŸèƒ½åç§°] ([è‹±æ–‡åŠŸèƒ½åç§°])

åŠŸèƒ½æ ‡è¯†ç¬¦ï¼š
[æ¨¡å—å‰ç¼€]-[åŠŸèƒ½ç¼–å·]
ç¤ºä¾‹ï¼šTRANS-001 è¡¨ç¤ºäº¤æ˜“æ¨¡å—çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½

æ‰€å±æ¨¡å—ï¼š
ä¸»è¦æ¨¡å—ï¼š[ä¾‹å¦‚ï¼šäº¤æ˜“ç®¡ç†]

ç›¸å…³æ¨¡å—ï¼š[ä¾‹å¦‚ï¼šåˆ†ç±»ç®¡ç†ã€è´¦æˆ·ç®¡ç†]

ä¼˜å…ˆçº§ï¼š
[P0] - æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»å®ç°

[P1] - é‡è¦åŠŸèƒ½ï¼Œå°½å¿«å®ç°

[P2] - å¢å¼ºåŠŸèƒ½ï¼Œåç»­å®ç°

[P3] - ä¼˜åŒ–åŠŸèƒ½ï¼Œå¯é€‰å®ç°

2. åŠŸèƒ½æè¿°
ç”¨æˆ·åœºæ™¯ï¼ˆUser Storyï¼‰
æ ¼å¼ï¼šä½œä¸º [ç”¨æˆ·è§’è‰²]ï¼Œæˆ‘æƒ³è¦ [åŠŸèƒ½éœ€æ±‚]ï¼Œä»¥ä¾¿äº [å•†ä¸šä»·å€¼]ã€‚

åœºæ™¯1ï¼š

text
ç”¨æˆ·è§’è‰²ï¼šæ™®é€šç”¨æˆ·
è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·å®Œæˆä¸€ç¬”æ¶ˆè´¹
ç”¨æˆ·è¡Œä¸ºï¼šç”¨æˆ·å¸Œæœ›å¿«é€Ÿè®°å½•è¿™ç¬”æ¶ˆè´¹
æœŸæœ›ç»“æœï¼šè®°å½•è¢«ä¿å­˜ï¼Œè´¦æˆ·ä½™é¢æ›´æ–°ï¼Œåˆ†ç±»æ­£ç¡®
åœºæ™¯2ï¼š

text
ç”¨æˆ·è§’è‰²ï¼šå®¶åº­ç®¡ç†è€…
è§¦å‘æ¡ä»¶ï¼šæ¯æœˆå›ºå®šè´¦å•åˆ°æœŸ
ç”¨æˆ·è¡Œä¸ºï¼šç³»ç»Ÿè‡ªåŠ¨è®°å½•æˆ–æé†’
æœŸæœ›ç»“æœï¼šè´¦å•è¢«è®°å½•ï¼Œè´¦æˆ·ä½™é¢ç›¸åº”å‡å°‘
ä¸šåŠ¡æµç¨‹å›¾
graph TD
    A[å¼€å§‹] --> B{ç”¨æˆ·æ“ä½œ}
    B -->|æ‰‹åŠ¨è¾“å…¥| C[å¡«å†™è¡¨å•]
    B -->|è¯­éŸ³è¾“å…¥| D[è¯­éŸ³è¯†åˆ«]
    B -->|å›¾ç‰‡ä¸Šä¼ | E[OCRè¯†åˆ«]
    C --> F[æ•°æ®éªŒè¯]
    D --> F
    E --> F
    F --> G{éªŒè¯ç»“æœ}
    G -->|é€šè¿‡| H[ä¿å­˜è®°å½•]
    G -->|å¤±è´¥| I[é”™è¯¯æç¤º]
    H --> J[æ›´æ–°ç›¸å…³æ•°æ®]
    J --> K[å‘é€é€šçŸ¥]
    K --> L[ç»“æŸ]
    I --> L

ä¸šåŠ¡è§„åˆ™
æ•°æ®æœ‰æ•ˆæ€§è§„åˆ™ï¼š

é‡‘é¢å¿…é¡»å¤§äº0

æ—¥æœŸä¸èƒ½è¶…è¿‡å½“å‰æ—¥æœŸ30å¤©

åˆ†ç±»å¿…é¡»å­˜åœ¨ä¸”å¯ç”¨

çŠ¶æ€è½¬æ¢è§„åˆ™ï¼š

text
å¾…å¤„ç† â†’ å·²ç¡®è®¤ â†’ å·²å®Œæˆ
        â†“
     å·²å–æ¶ˆ
æƒé™è§„åˆ™ï¼š

ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®

ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®

å…±äº«è´¦æˆ·éœ€è¦ç‰¹å®šæƒé™

3. è¾“å…¥/è¾“å‡ºè§„èŒƒ
è¾“å…¥æ•°æ®æ ¼å¼
typescript
// TypeScript æ¥å£å®šä¹‰
interface CreateTransactionInput {
  // å¿…éœ€å­—æ®µ
  amount: number;                    // é‡‘é¢ï¼Œå¿…é¡»å¤§äº0
  type: 'income' | 'expense' | 'transfer'; // äº¤æ˜“ç±»å‹
  accountId: string;                 // è´¦æˆ·IDï¼ŒUUIDæ ¼å¼
  transactionDate: string;          // ISO 8601æ—¥æœŸæ ¼å¼
  
  // å¯é€‰å­—æ®µ
  categoryId?: string;              // åˆ†ç±»IDï¼ŒUUIDæ ¼å¼
  payee?: string;                   // æ”¶æ¬¾æ–¹/ä»˜æ¬¾æ–¹ï¼Œæœ€å¤§é•¿åº¦200
  description?: string;            // æè¿°ï¼Œæœ€å¤§é•¿åº¦1000
  tags?: string[];                 // æ ‡ç­¾æ•°ç»„ï¼Œæ¯ä¸ªæ ‡ç­¾æœ€å¤§é•¿åº¦50
  attachmentUrls?: string[];       // é™„ä»¶URLæ•°ç»„
  isRecurring?: boolean;           // æ˜¯å¦é‡å¤äº¤æ˜“
  
  // æ¡ä»¶å­—æ®µ
  toAccountId?: string;            // ä»…å½“type='transfer'æ—¶å¿…éœ€
  recurringRule?: RecurringRule;   // ä»…å½“isRecurring=trueæ—¶å¿…éœ€
}

// éªŒè¯è§„åˆ™
const validationRules = {
  amount: {
    type: 'number',
    min: 0.01,
    max: 99999999.99,
    precision: 2,
    required: true
  },
  payee: {
    type: 'string',
    maxLength: 200,
    pattern: /^[\\p{L}\\p{N}\\s\\-\\.\\,\\(\\)\\[\\]@#]+$/u, // å…è®¸Unicodeå­—ç¬¦
    trim: true
  }
};
è¾“å‡ºæ•°æ®æ ¼å¼
typescript
// æˆåŠŸå“åº”
interface SuccessResponse<T = any> {
  success: true;
  code: number;                   // HTTPçŠ¶æ€ç 
  message: string;                // æˆåŠŸæ¶ˆæ¯ï¼ˆç”¨æˆ·å‹å¥½ï¼‰
  data: T;                       // å“åº”æ•°æ®
  timestamp: string;             // å“åº”æ—¶é—´æˆ³
  requestId: string;             // è¯·æ±‚IDï¼Œç”¨äºè¿½è¸ª
  pagination?: PaginationMeta;   // åˆ†é¡µä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
}

// å¤±è´¥å“åº”
interface ErrorResponse {
  success: false;
  code: number;                  // HTTPçŠ¶æ€ç 
  message: string;               // é”™è¯¯æ‘˜è¦ï¼ˆç”¨æˆ·å‹å¥½ï¼‰
  errorCode: string;             // ä¸šåŠ¡é”™è¯¯ä»£ç 
  errorDetails?: Array<{         // è¯¦ç»†é”™è¯¯ä¿¡æ¯
    field: string;
    message: string;
    code: string;
  }>;
  timestamp: string;
  requestId: string;
  documentationUrl?: string;     // ç›¸å…³æ–‡æ¡£é“¾æ¥
}

// åˆ†é¡µå“åº”ç¤ºä¾‹
interface PaginatedResponse<T> {
  data: T[];
  pagination: {
    total: number;              // æ€»è®°å½•æ•°
    page: number;              // å½“å‰é¡µç 
    limit: number;             // æ¯é¡µæ•°é‡
    totalPages: number;        // æ€»é¡µæ•°
    hasNext: boolean;          // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
    hasPrev: boolean;          // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
  };
}
APIç«¯ç‚¹è®¾è®¡
æ–¹æ³•	è·¯å¾„	æè¿°	è®¤è¯	æƒé™
POST	/api/v1/transactions	åˆ›å»ºäº¤æ˜“	Bearer Token	transaction:create
GET	/api/v1/transactions	è·å–äº¤æ˜“åˆ—è¡¨	Bearer Token	transaction:read
GET	/api/v1/transactions/:id	è·å–å•ä¸ªäº¤æ˜“	Bearer Token	transaction:read
PUT	/api/v1/transactions/:id	æ›´æ–°äº¤æ˜“	Bearer Token	transaction:update
DELETE	/api/v1/transactions/:id	åˆ é™¤äº¤æ˜“	Bearer Token	transaction:delete
4. é”™è¯¯å¤„ç†è§„èŒƒ
é”™è¯¯åˆ†ç±»
typescript
// é”™è¯¯ä»£ç ä½“ç³»
const ErrorCodes = {
  // ç³»ç»Ÿé”™è¯¯ (1000-1999)
  SYSTEM_ERROR: 1000,           // ç³»ç»Ÿå†…éƒ¨é”™è¯¯
  DATABASE_ERROR: 1001,         // æ•°æ®åº“é”™è¯¯
  NETWORK_ERROR: 1002,          // ç½‘ç»œé”™è¯¯
  
  // ä¸šåŠ¡é”™è¯¯ (2000-2999)
  VALIDATION_ERROR: 2000,       // æ•°æ®éªŒè¯å¤±è´¥
  NOT_FOUND: 2001,              // èµ„æºä¸å­˜åœ¨
  DUPLICATE_ENTRY: 2002,        // é‡å¤è®°å½•
  BUSINESS_RULE_VIOLATION: 2003, // è¿åä¸šåŠ¡è§„åˆ™
  
  // è®¤è¯æˆæƒé”™è¯¯ (3000-3999)
  UNAUTHORIZED: 3000,           // æœªæˆæƒ
  FORBIDDEN: 3001,              // æƒé™ä¸è¶³
  TOKEN_EXPIRED: 3002,          // Tokenè¿‡æœŸ
  INVALID_CREDENTIALS: 3003,    // æ— æ•ˆå‡­æ®
  
  // èµ„æºé”™è¯¯ (4000-4999)
  INSUFFICIENT_BALANCE: 4000,   // ä½™é¢ä¸è¶³
  RATE_LIMIT_EXCEEDED: 4001,    // é¢‘ç‡é™åˆ¶
  QUOTA_EXCEEDED: 4002,         // é…é¢è¶…é™
  
  // ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯ (5000-5999)
  AI_SERVICE_ERROR: 5000,       // AIæœåŠ¡é”™è¯¯
  PAYMENT_GATEWAY_ERROR: 5001,  // æ”¯ä»˜ç½‘å…³é”™è¯¯
};
é”™è¯¯å¤„ç†ç­–ç•¥
typescript
// NestJSå¼‚å¸¸è¿‡æ»¤å™¨ç¤ºä¾‹
@Catch()
export class GlobalExceptionFilter implements ExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const request = ctx.getRequest<Request>();
    
    let status = HttpStatus.INTERNAL_SERVER_ERROR;
    let errorCode = ErrorCodes.SYSTEM_ERROR;
    let message = 'ç³»ç»Ÿå†…éƒ¨é”™è¯¯';
    let errorDetails = null;
    
    if (exception instanceof HttpException) {
      status = exception.getStatus();
      const exceptionResponse = exception.getResponse();
      
      if (typeof exceptionResponse === 'string') {
        message = exceptionResponse;
      } else if (typeof exceptionResponse === 'object') {
        const { message: msg, errorCode: code, details } = exceptionResponse as any;
        message = msg || message;
        errorCode = code || errorCode;
        errorDetails = details;
      }
    } else if (exception instanceof ValidationError) {
      status = HttpStatus.BAD_REQUEST;
      errorCode = ErrorCodes.VALIDATION_ERROR;
      message = 'æ•°æ®éªŒè¯å¤±è´¥';
      errorDetails = this.formatValidationErrors(exception);
    }
    
    // è®°å½•é”™è¯¯æ—¥å¿—
    this.logger.error({
      errorCode,
      message,
      path: request.url,
      method: request.method,
      timestamp: new Date().toISOString(),
      user: request.user?.id,
      details: errorDetails,
      stack: exception instanceof Error ? exception.stack : undefined
    });
    
    // è¿”å›æ ‡å‡†é”™è¯¯å“åº”
    response.status(status).json({
      success: false,
      code: errorCode,
      message,
      errorDetails,
      timestamp: new Date().toISOString(),
      requestId: request.headers['x-request-id'] || uuidv4(),
      documentationUrl: `https://docs.example.com/errors/${errorCode}`
    });
  }
}
é¢„æœŸé”™è¯¯æƒ…å†µ
é”™è¯¯åœºæ™¯	è§¦å‘æ¡ä»¶	å¤„ç†æ–¹å¼	ç”¨æˆ·æç¤º
è´¦æˆ·ä½™é¢ä¸è¶³	æ”¯å‡ºè¶…è¿‡è´¦æˆ·ä½™é¢	é˜»æ­¢äº¤æ˜“ï¼Œè¿”å›é”™è¯¯	"è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œè¯·é€‰æ‹©å…¶ä»–è´¦æˆ·æˆ–å……å€¼"
é‡å¤äº¤æ˜“	ç›¸åŒé‡‘é¢ã€è´¦æˆ·ã€æ—¶é—´	æç¤ºç”¨æˆ·ç¡®è®¤	"æ£€æµ‹åˆ°å¯èƒ½é‡å¤çš„äº¤æ˜“ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ"
æ— æ•ˆåˆ†ç±»	åˆ†ç±»ä¸å­˜åœ¨æˆ–å·²ç¦ç”¨	ä½¿ç”¨é»˜è®¤åˆ†ç±»	"åˆ†ç±»æ— æ•ˆï¼Œå·²ä½¿ç”¨é»˜è®¤åˆ†ç±»"
æ—¥æœŸéæ³•	æ—¥æœŸè¶…å‡ºå…è®¸èŒƒå›´	ä½¿ç”¨å½“å‰æ—¥æœŸ	"æ—¥æœŸè¶…å‡ºèŒƒå›´ï¼Œå·²ä½¿ç”¨å½“å‰æ—¥æœŸ"
ç½‘ç»œè¶…æ—¶	APIå“åº”è¶…æ—¶	è‡ªåŠ¨é‡è¯•2æ¬¡	"ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œæ­£åœ¨é‡è¯•..."
5. æŠ€æœ¯è¦æ±‚
æ•°æ®åº“å±‚è®¾è®¡
sql
-- è¡¨ç»“æ„å˜æ›´ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
-- 1. ä¸»è¡¨å˜æ›´
ALTER TABLE transactions 
ADD COLUMN IF NOT EXISTS ai_processed BOOLEAN DEFAULT false,
ADD COLUMN IF NOT EXISTS processing_attempts INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS last_processed_at TIMESTAMP;

-- 2. ç´¢å¼•è®¾è®¡
CREATE INDEX IF NOT EXISTS idx_transactions_user_date_type 
ON transactions(user_id, transaction_date DESC, type);

CREATE INDEX IF NOT EXISTS idx_transactions_user_category 
ON transactions(user_id, category_id) 
WHERE category_id IS NOT NULL;

-- 3. æ•°æ®éªŒè¯çº¦æŸ
ALTER TABLE transactions 
ADD CONSTRAINT check_amount_positive CHECK (amount > 0),
ADD CONSTRAINT check_valid_date CHECK (
  transaction_date >= '2020-01-01' AND 
  transaction_date <= CURRENT_DATE + INTERVAL '30 days'
),
ADD CONSTRAINT check_transfer_accounts CHECK (
  (type = 'transfer' AND from_account_id IS NOT NULL AND to_account_id IS NOT NULL) OR
  (type != 'transfer' AND from_account_id IS NULL AND to_account_id IS NULL)
);

-- 4. è§†å›¾åˆ›å»º
CREATE OR REPLACE VIEW v_daily_summary AS
SELECT 
  user_id,
  transaction_date,
  COUNT(*) as transaction_count,
  SUM(CASE WHEN type = 'income' THEN amount ELSE 0 END) as total_income,
  SUM(CASE WHEN type = 'expense' THEN amount ELSE 0 END) as total_expense
FROM transactions
WHERE status = 'completed'
GROUP BY user_id, transaction_date;
APIå±‚è®¾è®¡
typescript
// 1. DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰
export class CreateTransactionDto {
  @ApiProperty({ description: 'äº¤æ˜“é‡‘é¢', example: 100.50 })
  @IsNumber({ maxDecimalPlaces: 2 })
  @Min(0.01)
  @Max(99999999.99)
  amount: number;
  
  @ApiProperty({ description: 'äº¤æ˜“ç±»å‹', enum: TransactionType })
  @IsEnum(TransactionType)
  type: TransactionType;
  
  @ApiProperty({ description: 'è´¦æˆ·ID', example: 'uuid' })
  @IsUUID()
  accountId: string;
  
  @ApiProperty({ description: 'äº¤æ˜“æ—¥æœŸ', example: '2024-01-15' })
  @IsISO8601()
  @IsDateString()
  transactionDate: string;
  
  // æ¡ä»¶éªŒè¯
  @ValidateIf(o => o.type === 'transfer')
  @IsUUID()
  toAccountId?: string;
}

// 2. æ§åˆ¶å™¨
@Controller('transactions')
@UseGuards(JwtAuthGuard)
@ApiTags('transactions')
@ApiBearerAuth()
export class TransactionsController {
  constructor(private readonly transactionsService: TransactionsService) {}
  
  @Post()
  @ApiOperation({ summary: 'åˆ›å»ºäº¤æ˜“', description: 'åˆ›å»ºä¸€ç¬”æ–°çš„äº¤æ˜“è®°å½•' })
  @ApiResponse({ 
    status: 201, 
    description: 'äº¤æ˜“åˆ›å»ºæˆåŠŸ',
    type: TransactionResponseDto 
  })
  @ApiResponse({ 
    status: 400, 
    description: 'å‚æ•°éªŒè¯å¤±è´¥',
    type: ValidationErrorResponse 
  })
  @UsePipes(new ValidationPipe({ transform: true, whitelist: true }))
  async create(
    @Body() createTransactionDto: CreateTransactionDto,
    @Request() req: AuthenticatedRequest
  ) {
    const userId = req.user.id;
    return this.transactionsService.create(createTransactionDto, userId);
  }
  
  @Get()
  @ApiOperation({ summary: 'è·å–äº¤æ˜“åˆ—è¡¨' })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'limit', required: false, type: Number })
  @ApiQuery({ name: 'startDate', required: false, type: String })
  @ApiQuery({ name: 'endDate', required: false, type: String })
  async findAll(
    @Query() query: TransactionQueryDto,
    @Request() req: AuthenticatedRequest
  ) {
    const userId = req.user.id;
    return this.transactionsService.findAll(query, userId);
  }
}
å‰ç«¯ç»„ä»¶è®¾è®¡
typescript
// 1. ç»„ä»¶ç»“æ„
/**
 * äº¤æ˜“è¡¨å•ç»„ä»¶
 * åŠŸèƒ½ï¼šåˆ›å»ºå’Œç¼–è¾‘äº¤æ˜“è®°å½•
 * ç‰¹æ€§ï¼šæ”¯æŒæ‰‹åŠ¨è¾“å…¥ã€è¯­éŸ³è¾“å…¥ã€å›¾ç‰‡è¯†åˆ«
 */
const TransactionForm: React.FC<TransactionFormProps> = ({
  initialValues,
  onSubmit,
  onCancel,
  mode = 'create'
}) => {
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [aiSuggestions, setAiSuggestions] = useState<AiSuggestion[]>([]);
  
  // è¡¨å•å¸ƒå±€é…ç½®
  const formLayout = {
    labelCol: { span: 6 },
    wrapperCol: { span: 18 }
  };
  
  // è¡¨å•æäº¤å¤„ç†
  const handleSubmit = async (values: TransactionFormValues) => {
    try {
      setLoading(true);
      const result = await onSubmit(values);
      message.success(mode === 'create' ? 'äº¤æ˜“åˆ›å»ºæˆåŠŸ' : 'äº¤æ˜“æ›´æ–°æˆåŠŸ');
      form.resetFields();
      return result;
    } catch (error) {
      message.error('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
      throw error;
    } finally {
      setLoading(false);
    }
  };
  
  // AIåˆ†ç±»å»ºè®®
  const handleDescriptionChange = useDebounce(async (description: string) => {
    if (description.length > 3) {
      const suggestions = await fetchAiSuggestions(description);
      setAiSuggestions(suggestions);
    }
  }, 500);
  
  return (
    <Card 
      title={mode === 'create' ? 'æ·»åŠ äº¤æ˜“' : 'ç¼–è¾‘äº¤æ˜“'}
      extra={
        <Space>
          <Button onClick={onCancel}>å–æ¶ˆ</Button>
          <Button 
            type="primary" 
            onClick={() => form.submit()}
            loading={loading}
          >
            ä¿å­˜
          </Button>
        </Space>
      }
    >
      <Form
        {...formLayout}
        form={form}
        initialValues={initialValues}
        onFinish={handleSubmit}
      >
        {/* äº¤æ˜“ç±»å‹é€‰æ‹©å™¨ */}
        <Form.Item
          name="type"
          label="äº¤æ˜“ç±»å‹"
          rules={[{ required: true, message: 'è¯·é€‰æ‹©äº¤æ˜“ç±»å‹' }]}
        >
          <Segmented 
            options={[
              { label: 'æ”¯å‡º', value: 'expense', icon: <ArrowDownOutlined /> },
              { label: 'æ”¶å…¥', value: 'income', icon: <ArrowUpOutlined /> },
              { label: 'è½¬è´¦', value: 'transfer', icon: <SwapOutlined /> }
            ]}
            block
          />
        </Form.Item>
        
        {/* é‡‘é¢è¾“å…¥ */}
        <Form.Item
          name="amount"
          label="é‡‘é¢"
          rules={[
            { required: true, message: 'è¯·è¾“å…¥é‡‘é¢' },
            { pattern: /^\d+(\.\d{1,2})?$/, message: 'é‡‘é¢æ ¼å¼ä¸æ­£ç¡®' }
          ]}
        >
          <InputNumber 
            style={{ width: '100%' }}
            min={0.01}
            max={99999999.99}
            precision={2}
            addonAfter="Â¥"
            placeholder="0.00"
          />
        </Form.Item>
        
        {/* AIè¾…åŠ©æè¿°è¾“å…¥ */}
        <Form.Item
          name="description"
          label="æè¿°"
          extra={
            aiSuggestions.length > 0 && (
              <div className="ai-suggestions">
                <span>AIå»ºè®®ï¼š</span>
                {aiSuggestions.map(suggestion => (
                  <Tag 
                    key={suggestion.categoryId}
                    color="blue"
                    onClick={() => {
                      form.setFieldsValue({
                        categoryId: suggestion.categoryId,
                        tags: suggestion.tags
                      });
                    }}
                  >
                    {suggestion.categoryName}
                  </Tag>
                ))}
              </div>
            )
          }
        >
          <Input.TextArea 
            rows={2}
            placeholder="è¾“å…¥æ¶ˆè´¹æè¿°ï¼ŒAIå°†è‡ªåŠ¨æ¨èåˆ†ç±»..."
            onChange={(e) => handleDescriptionChange(e.target.value)}
          />
        </Form.Item>
        
        {/* æ›´å¤šå­—æ®µ... */}
      </Form>
    </Card>
  );
};
6. æµ‹è¯•è¦æ±‚
æµ‹è¯•ç­–ç•¥
typescript
// 1. å•å…ƒæµ‹è¯•
describe('TransactionService', () => {
  let service: TransactionService;
  let repository: MockProxy<TransactionRepository>;
  
  beforeEach(async () => {
    repository = mock<TransactionRepository>();
    service = new TransactionService(repository);
  });
  
  describe('create', () => {
    it('åº”è¯¥æˆåŠŸåˆ›å»ºäº¤æ˜“', async () => {
      // å‡†å¤‡
      const dto = {
        amount: 100,
        type: 'expense',
        accountId: 'uuid',
        transactionDate: '2024-01-15'
      };
      const userId = 'user-uuid';
      
      repository.create.mockResolvedValue({
        id: 'transaction-uuid',
        ...dto,
        userId,
        status: 'completed'
      });
      
      // æ‰§è¡Œ
      const result = await service.create(dto, userId);
      
      // æ–­è¨€
      expect(repository.create).toHaveBeenCalledWith(expect.objectContaining({
        ...dto,
        userId
      }));
      expect(result.id).toBeDefined();
    });
    
    it('å½“è´¦æˆ·ä½™é¢ä¸è¶³æ—¶åº”æŠ›å‡ºé”™è¯¯', async () => {
      // å‡†å¤‡
      const dto = {
        amount: 10000,
        type: 'expense',
        accountId: 'low-balance-account',
        transactionDate: '2024-01-15'
      };
      
      // æ¨¡æ‹Ÿè´¦æˆ·ä½™é¢æ£€æŸ¥å¤±è´¥
      jest.spyOn(service, 'checkAccountBalance').mockRejectedValue(
        new BusinessError('è´¦æˆ·ä½™é¢ä¸è¶³')
      );
      
      // æ‰§è¡Œå’Œæ–­è¨€
      await expect(service.create(dto, 'user-uuid'))
        .rejects
        .toThrow('è´¦æˆ·ä½™é¢ä¸è¶³');
    });
  });
});

// 2. é›†æˆæµ‹è¯•
describe('Transactions API', () => {
  let app: INestApplication;
  
  beforeAll(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();
    
    app = moduleRef.createNestApplication();
    await app.init();
  });
  
  describe('POST /transactions', () => {
    it('åº”åˆ›å»ºäº¤æ˜“å¹¶è¿”å›201çŠ¶æ€ç ', async () => {
      const createDto = {
        amount: 150.75,
        type: 'expense',
        accountId: 'test-account-id',
        transactionDate: '2024-01-15',
        description: 'åˆé¤æ¶ˆè´¹'
      };
      
      const response = await request(app.getHttpServer())
        .post('/transactions')
        .set('Authorization', 'Bearer valid-token')
        .send(createDto);
      
      expect(response.status).toBe(201);
      expect(response.body.data).toHaveProperty('id');
      expect(response.body.data.amount).toBe(150.75);
    });
    
    it('å½“ç¼ºå°‘å¿…éœ€å­—æ®µæ—¶åº”è¿”å›400çŠ¶æ€ç ', async () => {
      const invalidDto = {
        type: 'expense',
        // ç¼ºå°‘ amount å­—æ®µ
        accountId: 'test-account-id'
      };
      
      const response = await request(app.getHttpServer())
        .post('/transactions')
        .set('Authorization', 'Bearer valid-token')
        .send(invalidDto);
      
      expect(response.status).toBe(400);
      expect(response.body.errorCode).toBe('VALIDATION_ERROR');
    });
  });
});

// 3. E2Eæµ‹è¯•ï¼ˆCypressï¼‰
describe('äº¤æ˜“åŠŸèƒ½E2Eæµ‹è¯•', () => {
  beforeEach(() => {
    cy.login('test@example.com', 'password123');
    cy.visit('/transactions');
  });
  
  it('åº”è¯¥æˆåŠŸæ·»åŠ äº¤æ˜“', () => {
    cy.get('[data-testid="add-transaction-btn"]').click();
    cy.get('[data-testid="amount-input"]').type('88.88');
    cy.get('[data-testid="category-select"]').click();
    cy.get('[data-testid="category-food"]').click();
    cy.get('[data-testid="submit-btn"]').click();
    
    cy.get('.ant-message-success').should('contain', 'äº¤æ˜“åˆ›å»ºæˆåŠŸ');
    cy.get('[data-testid="transaction-list"]').should('contain', '88.88');
  });
  
  it('åº”è¯¥æ˜¾ç¤ºè¡¨å•éªŒè¯é”™è¯¯', () => {
    cy.get('[data-testid="add-transaction-btn"]').click();
    cy.get('[data-testid="submit-btn"]').click();
    
    cy.get('.ant-form-item-explain-error').should('contain', 'è¯·è¾“å…¥é‡‘é¢');
  });
});
æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
yaml
æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡:
  - è¯­å¥è¦†ç›–ç‡: > 85%
  - åˆ†æ”¯è¦†ç›–ç‡: > 80%
  - å‡½æ•°è¦†ç›–ç‡: > 90%
  - è¡Œè¦†ç›–ç‡: > 85%
  
éœ€è¦æµ‹è¯•çš„åœºæ™¯:
  æ­£é¢æµ‹è¯•:
    - æ­£å¸¸æµç¨‹ï¼ˆhappy pathï¼‰
    - è¾¹ç•Œå€¼æµ‹è¯•ï¼ˆæœ€å¤§å€¼ã€æœ€å°å€¼ï¼‰
    - å¯é€‰å­—æ®µæµ‹è¯•
    
  è´Ÿé¢æµ‹è¯•:
    - æ— æ•ˆè¾“å…¥ï¼ˆç©ºå€¼ã€é”™è¯¯ç±»å‹ï¼‰
    - æƒé™ä¸è¶³
    - èµ„æºä¸å­˜åœ¨
    - å¹¶å‘æ“ä½œ
    - ç½‘ç»œè¶…æ—¶/ä¸­æ–­
    
  æ€§èƒ½æµ‹è¯•:
    - å“åº”æ—¶é—´ < 500ms
    - å†…å­˜ä½¿ç”¨ < 100MB
    - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
7. æ€§èƒ½ä¸å®‰å…¨è¦æ±‚
æ€§èƒ½è¦æ±‚
typescript
// æ€§èƒ½æŒ‡æ ‡
const PerformanceMetrics = {
  // APIå“åº”æ—¶é—´
  apiResponseTime: {
    p50: '< 100ms',    // 50%çš„è¯·æ±‚
    p90: '< 300ms',    // 90%çš„è¯·æ±‚
    p99: '< 1000ms',   // 99%çš„è¯·æ±‚
  },
  
  // æ•°æ®åº“æŸ¥è¯¢
  databaseQueries: {
    maxComplexity: 3,  // æœ€å¤§JOINæ•°é‡
    maxExecutionTime: '50ms',
    indexingCoverage: '> 95%',
  },
  
  // å‰ç«¯æ€§èƒ½
  frontendMetrics: {
    firstContentfulPaint: '< 1.5s',
    largestContentfulPaint: '< 2.5s',
    cumulativeLayoutShift: '< 0.1',
    firstInputDelay: '< 100ms',
  },
  
  // ç¼“å­˜ç­–ç•¥
  cachingStrategy: {
    redisTTL: {
      short: '60s',    // çŸ­ç¼“å­˜
      medium: '300s',  // ä¸­ç¼“å­˜
      long: '3600s',   // é•¿ç¼“å­˜
    },
    cacheHitRate: '> 85%',
  }
};
å®‰å…¨è¦æ±‚
typescript
// å®‰å…¨æªæ–½
const SecurityRequirements = {
  // è¾“å…¥éªŒè¯
  inputValidation: {
    sanitizeHtml: true,
    validateSchema: true,
    maxLength: {
      strings: 1000,
      arrays: 100,
      numbers: 20
    }
  },
  
  // æ•°æ®ä¿æŠ¤
  dataProtection: {
    encryption: {
      inTransit: 'TLS 1.3',
      atRest: 'AES-256',
      sensitiveFields: ['amount', 'accountNumber', 'personalInfo']
    },
    masking: {
      accountNumbers: 'last4',
      personalInfo: 'partial'
    }
  },
  
  // è®¿é—®æ§åˆ¶
  accessControl: {
    authentication: 'JWT + Refresh Tokens',
    authorization: 'RBAC + ABAC',
    rateLimiting: {
      perUser: '100 requests/minute',
      perIP: '1000 requests/minute'
    }
  },
  
  // å®¡è®¡æ—¥å¿—
  auditLogging: {
    requiredEvents: [
      'create', 'update', 'delete',
      'login', 'logout', 'failed_attempt'
    ],
    retentionPeriod: '90 days'
  }
};
8. ä»£ç ç¤ºä¾‹ï¼ˆå®Œæ•´å®ç°ï¼‰
åç«¯æœåŠ¡å®Œæ•´ç¤ºä¾‹
typescript
// transaction.service.ts
@Injectable()
export class TransactionService {
  constructor(
    @Inject(TRANSACTION_REPOSITORY)
    private readonly transactionRepository: TransactionRepository,
    private readonly accountService: AccountService,
    private readonly categoryService: CategoryService,
    private readonly auditService: AuditService,
    private readonly cacheService: CacheService,
    private readonly eventEmitter: EventEmitter2,
    private readonly logger: Logger
  ) {}
  
  /**
   * åˆ›å»ºäº¤æ˜“
   */
  async create(
    createTransactionDto: CreateTransactionDto,
    userId: string,
    context?: RequestContext
  ): Promise<TransactionResponse> {
    const startTime = Date.now();
    
    try {
      // 1. éªŒè¯ä¸šåŠ¡è§„åˆ™
      await this.validateBusinessRules(createTransactionDto, userId);
      
      // 2. å‡†å¤‡äº¤æ˜“æ•°æ®
      const transactionData = await this.prepareTransactionData(
        createTransactionDto,
        userId
      );
      
      // 3. å¼€å§‹æ•°æ®åº“äº‹åŠ¡
      const transaction = await this.transactionRepository
        .manager
        .transaction(async (entityManager) => {
          
          // 3.1 ä¿å­˜äº¤æ˜“è®°å½•
          const transaction = entityManager.create(
            Transaction,
            transactionData
          );
          
          const savedTransaction = await entityManager.save(transaction);
          
          // 3.2 æ›´æ–°è´¦æˆ·ä½™é¢
          await this.updateAccountBalances(
            savedTransaction,
            entityManager
          );
          
          // 3.3 æ›´æ–°é¢„ç®—ç»Ÿè®¡
          await this.updateBudgetStatistics(
            savedTransaction,
            entityManager
          );
          
          return savedTransaction;
        });
      
      // 4. å¼‚æ­¥å¤„ç†ä»»åŠ¡
      await Promise.all([
        // 4.1 æ¸…é™¤ç›¸å…³ç¼“å­˜
        this.cacheService.invalidate([
          `user:${userId}:transactions`,
          `user:${userId}:daily_summary`,
          `user:${userId}:account_balance`
        ]),
        
        // 4.2 å‘é€äº‹ä»¶é€šçŸ¥
        this.eventEmitter.emitAsync(
          'transaction.created',
          new TransactionCreatedEvent(transaction, userId)
        ),
        
        // 4.3 è®°å½•å®¡è®¡æ—¥å¿—
        this.auditService.log({
          action: 'transaction.create',
          userId,
          entityId: transaction.id,
          entityType: 'transaction',
          metadata: {
            amount: transaction.amount,
            type: transaction.type
          },
          context
        }),
        
        // 4.4 AIå¤„ç†ï¼ˆéé˜»å¡ï¼‰
        this.processWithAI(transaction).catch(err => {
          this.logger.error('AIå¤„ç†å¤±è´¥', err);
        })
      ]);
      
      // 5. è®°å½•æ€§èƒ½æŒ‡æ ‡
      const duration = Date.now() - startTime;
      this.logger.log(`Transaction created in ${duration}ms`, {
        transactionId: transaction.id,
        userId,
        duration
      });
      
      // 6. è¿”å›å“åº”
      return this.mapToResponse(transaction);
      
    } catch (error) {
      this.logger.error('åˆ›å»ºäº¤æ˜“å¤±è´¥', {
        error: error.message,
        userId,
        dto: createTransactionDto,
        stack: error.stack
      });
      
      if (error instanceof BusinessError) {
        throw error;
      }
      
      throw new InternalServerErrorException('äº¤æ˜“åˆ›å»ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    }
  }
  
  /**
   * éªŒè¯ä¸šåŠ¡è§„åˆ™
   */
  private async validateBusinessRules(
    dto: CreateTransactionDto,
    userId: string
  ): Promise<void> {
    const validations = [
      // éªŒè¯è´¦æˆ·å­˜åœ¨ä¸”å±äºç”¨æˆ·
      this.validateAccount(dto.accountId, userId),
      
      // éªŒè¯åˆ†ç±»å­˜åœ¨ï¼ˆå¦‚æœæœ‰ï¼‰
      dto.categoryId ? this.validateCategory(dto.categoryId, userId) : Promise.resolve(),
      
      // éªŒè¯é‡‘é¢æœ‰æ•ˆæ€§
      this.validateAmount(dto.amount, dto.type),
      
      // éªŒè¯æ—¥æœŸæœ‰æ•ˆæ€§
      this.validateDate(dto.transactionDate),
    ];
    
    // å¦‚æœæ˜¯è½¬è´¦ï¼ŒéªŒè¯ç›®æ ‡è´¦æˆ·
    if (dto.type === 'transfer' && dto.toAccountId) {
      validations.push(this.validateAccount(dto.toAccountId, userId));
    }
    
    await Promise.all(validations);
  }
  
  /**
   * å‡†å¤‡äº¤æ˜“æ•°æ®
   */
  private async prepareTransactionData(
    dto: CreateTransactionDto,
    userId: string
  ): Promise<Partial<Transaction>> {
    const data: Partial<Transaction> = {
      ...dto,
      userId,
      status: 'completed' as TransactionStatus,
      createdAt: new Date(),
      updatedAt: new Date()
    };
    
    // ä½¿ç”¨AIè‡ªåŠ¨åˆ†ç±»ï¼ˆå¦‚æœç”¨æˆ·æœªæŒ‡å®šåˆ†ç±»ï¼‰
    if (!dto.categoryId && dto.description) {
      const aiCategory = await this.suggestCategory(dto.description);
      if (aiCategory) {
        data.categoryId = aiCategory.id;
        data.aiProcessed = true;
        data.aiConfidence = aiCategory.confidence;
      }
    }
    
    return data;
  }
}
å‰ç«¯ç»„ä»¶å®Œæ•´ç¤ºä¾‹
typescript
// TransactionList.tsx
import React, { useState, useEffect } from 'react';
import {
  Table,
  Card,
  Button,
  Space,
  Input,
  DatePicker,
  Select,
  Tag,
  Statistic,
  message,
  Modal,
  Empty,
  Spin
} from 'antd';
import {
  PlusOutlined,
  SearchOutlined,
  FilterOutlined,
  DownloadOutlined,
  EyeOutlined,
  EditOutlined,
  DeleteOutlined
} from '@ant-design/icons';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import dayjs from 'dayjs';
import TransactionForm from './TransactionForm';
import { Transaction, TransactionQueryParams } from '@/types/transaction';
import { transactionAPI } from '@/api/transaction';
import { useAuth } from '@/hooks/useAuth';

const { RangePicker } = DatePicker;
const { Option } = Select;

const TransactionList: React.FC = () => {
  const { user } = useAuth();
  const queryClient = useQueryClient();
  
  // çŠ¶æ€ç®¡ç†
  const [queryParams, setQueryParams] = useState<TransactionQueryParams>({
    page: 1,
    limit: 20,
    sortBy: 'transactionDate',
    sortOrder: 'desc'
  });
  
  const [selectedRows, setSelectedRows] = useState<Transaction[]>([]);
  const [showForm, setShowForm] = useState(false);
  const [editingTransaction, setEditingTransaction] = useState<Transaction | null>(null);
  const [filtersVisible, setFiltersVisible] = useState(false);
  
  // æ•°æ®æŸ¥è¯¢
  const {
    data: transactionData,
    isLoading,
    error,
    refetch
  } = useQuery({
    queryKey: ['transactions', queryParams],
    queryFn: () => transactionAPI.getTransactions(queryParams),
    enabled: !!user,
    staleTime: 60000, // 1åˆ†é’Ÿç¼“å­˜
    retry: 3,
    retryDelay: (attempt) => Math.min(1000 * 2 ** attempt, 30000)
  });
  
  // ç»Ÿè®¡æ•°æ®æŸ¥è¯¢
  const { data: summaryData } = useQuery({
    queryKey: ['transactionSummary', queryParams],
    queryFn: () => transactionAPI.getSummary(queryParams),
    enabled: !!user && !isLoading
  });
  
  // åˆ é™¤äº¤æ˜“
  const deleteMutation = useMutation({
    mutationFn: (id: string) => transactionAPI.deleteTransaction(id),
    onSuccess: () => {
      message.success('äº¤æ˜“åˆ é™¤æˆåŠŸ');
      queryClient.invalidateQueries({ queryKey: ['transactions'] });
      queryClient.invalidateQueries({ queryKey: ['transactionSummary'] });
      setSelectedRows([]);
    },
    onError: (error: any) => {
      message.error(`åˆ é™¤å¤±è´¥: ${error.message}`);
    }
  });
  
  // åˆ—å®šä¹‰
  const columns = [
    {
      title: 'æ—¥æœŸ',
      dataIndex: 'transactionDate',
      key: 'date',
      width: 120,
      render: (date: string) => dayjs(date).format('MM/DD'),
      sorter: true
    },
    {
      title: 'æè¿°',
      dataIndex: 'description',
      key: 'description',
      ellipsis: true,
      render: (text: string, record: Transaction) => (
        <Space direction="vertical" size={2}>
          <div>{text || 'æ— æè¿°'}</div>
          {record.payee && (
            <small style={{ color: '#666' }}>{record.payee}</small>
          )}
        </Space>
      )
    },
    {
      title: 'åˆ†ç±»',
      dataIndex: 'category',
      key: 'category',
      width: 120,
      render: (category: any) => (
        <Tag color={category?.color || '#888'}>
          {category?.name || 'æœªåˆ†ç±»'}
        </Tag>
      )
    },
    {
      title: 'é‡‘é¢',
      dataIndex: 'amount',
      key: 'amount',
      width: 120,
      align: 'right' as const,
      render: (amount: number, record: Transaction) => (
        <span
          style={{
            color: record.type === 'income' ? '#52c41a' : '#f5222d',
            fontWeight: 500
          }}
        >
          {record.type === 'income' ? '+' : '-'}
          {amount.toFixed(2)}
        </span>
      ),
      sorter: true
    },
    {
      title: 'è´¦æˆ·',
      dataIndex: 'account',
      key: 'account',
      width: 120,
      render: (account: any) => account?.name || 'æœªçŸ¥è´¦æˆ·'
    },
    {
      title: 'æ“ä½œ',
      key: 'actions',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: Transaction) => (
        <Space size="small">
          <Button
            type="text"
            size="small"
            icon={<EyeOutlined />}
            onClick={() => handleView(record)}
          />
          <Button
            type="text"
            size="small"
            icon={<EditOutlined />}
            onClick={() => handleEdit(record)}
          />
          <Button
            type="text"
            size="small"
            danger
            icon={<DeleteOutlined />}
            onClick={() => handleDelete(record.id)}
            loading={deleteMutation.isLoading}
          />
        </Space>
      )
    }
  ];
  
  // äº‹ä»¶å¤„ç†
  const handleSearch = (value: string) => {
    setQueryParams(prev => ({
      ...prev,
      search: value,
      page: 1
    }));
  };
  
  const handleDateChange = (dates: any) => {
    if (dates) {
      setQueryParams(prev => ({
        ...prev,
        startDate: dates[0].format('YYYY-MM-DD'),
        endDate: dates[1].format('YYYY-MM-DD'),
        page: 1
      }));
    }
  };
  
  const handleTableChange = (pagination: any, filters: any, sorter: any) => {
    setQueryParams(prev => ({
      ...prev,
      page: pagination.current,
      limit: pagination.pageSize,
      sortBy: sorter.field || 'transactionDate',
      sortOrder: sorter.order === 'ascend' ? 'asc' : 'desc'
    }));
  };
  
  const handleDelete = (id: string) => {
    Modal.confirm({
      title: 'ç¡®è®¤åˆ é™¤',
      content: 'ç¡®å®šè¦åˆ é™¤è¿™ç¬”äº¤æ˜“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚',
      okText: 'åˆ é™¤',
      okType: 'danger',
      cancelText: 'å–æ¶ˆ',
      onOk: () => deleteMutation.mutate(id)
    });
  };
  
  const handleEdit = (transaction: Transaction) => {
    setEditingTransaction(transaction);
    setShowForm(true);
  };
  
  const handleFormSuccess = () => {
    setShowForm(false);
    setEditingTransaction(null);
    refetch();
  };
  
  // æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡
  const renderStatistics = () => {
    if (!summaryData) return null;
    
    return (
      <Card size="small" className="mb-4">
        <div className="grid grid-cols-4 gap-4">
          <Statistic
            title="æ€»æ”¶å…¥"
            value={summaryData.totalIncome}
            precision={2}
            valueStyle={{ color: '#52c41a' }}
            prefix="Â¥"
          />
          <Statistic
            title="æ€»æ”¯å‡º"
            value={summaryData.totalExpense}
            precision={2}
            valueStyle={{ color: '#f5222d' }}
            prefix="Â¥"
          />
          <Statistic
            title="äº¤æ˜“ç¬”æ•°"
            value={summaryData.transactionCount}
          />
          <Statistic
            title="å‡€æ”¶å…¥"
            value={summaryData.netIncome}
            precision={2}
            valueStyle={{
              color: summaryData.netIncome >= 0 ? '#52c41a' : '#f5222d'
            }}
            prefix="Â¥"
          />
        </div>
      </Card>
    );
  };
  
  // æ¸²æŸ“ç­›é€‰å™¨
  const renderFilters = () => (
    <Card size="small" className="mb-4" hidden={!filtersVisible}>
      <div className="grid grid-cols-4 gap-4">
        <Input
          placeholder="æœç´¢æè¿°æˆ–æ”¶æ¬¾æ–¹"
          prefix={<SearchOutlined />}
          allowClear
          onChange={(e) => handleSearch(e.target.value)}
        />
        <RangePicker
          style={{ width: '100%' }}
          onChange={handleDateChange}
        />
        <Select placeholder="é€‰æ‹©åˆ†ç±»" allowClear>
          {/* åˆ†ç±»é€‰é¡¹ */}
        </Select>
        <Select placeholder="é€‰æ‹©è´¦æˆ·" allowClear>
          {/* è´¦æˆ·é€‰é¡¹ */}
        </Select>
      </div>
    </Card>
  );
  
  // é”™è¯¯å¤„ç†
  if (error) {
    return (
      <Card>
        <Empty
          image={Empty.PRESENTED_IMAGE_SIMPLE}
          description={
            <div>
              <p>æ•°æ®åŠ è½½å¤±è´¥</p>
              <Button type="link" onClick={() => refetch()}>
                ç‚¹å‡»é‡è¯•
              </Button>
            </div>
          }
        />
      </Card>
    );
  }
  
  return (
    <div className="transaction-list">
      {/* æ“ä½œæ  */}
      <Card className="mb-4">
        <div className="flex justify-between items-center">
          <Space>
            <Button
              type="primary"
              icon={<PlusOutlined />}
              onClick={() => setShowForm(true)}
            >
              æ·»åŠ äº¤æ˜“
            </Button>
            <Button
              icon={<FilterOutlined />}
              onClick={() => setFiltersVisible(!filtersVisible)}
            >
              {filtersVisible ? 'éšè—ç­›é€‰' : 'æ˜¾ç¤ºç­›é€‰'}
            </Button>
            {selectedRows.length > 0 && (
              <Button
                danger
                icon={<DeleteOutlined />}
                onClick={() => {
                  Modal.confirm({
                    title: `ç¡®è®¤åˆ é™¤${selectedRows.length}ç¬”äº¤æ˜“`,
                    content: 'æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œç¡®å®šè¦åˆ é™¤å—ï¼Ÿ',
                    onOk: () => {
                      // æ‰¹é‡åˆ é™¤é€»è¾‘
                    }
                  });
                }}
              >
                æ‰¹é‡åˆ é™¤
              </Button>
            )}
          </Space>
          <Space>
            <Button icon={<DownloadOutlined />}>å¯¼å‡º</Button>
          </Space>
        </div>
      </Card>
      
      {/* ç»Ÿè®¡æ•°æ® */}
      {renderStatistics()}
      
      {/* ç­›é€‰å™¨ */}
      {renderFilters()}
      
      {/* æ•°æ®è¡¨æ ¼ */}
      <Card>
        <Spin spinning={isLoading}>
          <Table
            columns={columns}
            dataSource={transactionData?.data || []}
            rowKey="id"
            rowSelection={{
              selectedRowKeys: selectedRows.map(row => row.id),
              onChange: (_, selectedRows) => setSelectedRows(selectedRows),
            }}
            pagination={{
              current: queryParams.page,
              pageSize: queryParams.limit,
              total: transactionData?.pagination?.total || 0,
              showSizeChanger: true,
              showQuickJumper: true,
              showTotal: (total) => `å…± ${total} æ¡è®°å½•`,
              pageSizeOptions: ['20', '50', '100']
            }}
            onChange={handleTableChange}
            scroll={{ x: 1200 }}
            size="middle"
            bordered
          />
        </Spin>
      </Card>
      
      {/* äº¤æ˜“è¡¨å•å¼¹çª— */}
      <Modal
        title={editingTransaction ? 'ç¼–è¾‘äº¤æ˜“' : 'æ·»åŠ äº¤æ˜“'}
        open={showForm}
        onCancel={() => {
          setShowForm(false);
          setEditingTransaction(null);
        }}
        footer={null}
        width={700}
        destroyOnClose
      >
        <TransactionForm
          initialValues={editingTransaction}
          onSubmit={async (values) => {
            if (editingTransaction) {
              return transactionAPI.updateTransaction(editingTransaction.id, values);
            } else {
              return transactionAPI.createTransaction(values);
            }
          }}
          onSuccess={handleFormSuccess}
          onCancel={() => {
            setShowForm(false);
            setEditingTransaction(null);
          }}
        />
      </Modal>
    </div>
  );
};

export default TransactionList;
9. éƒ¨ç½²ä¸ç›‘æ§è¦æ±‚
éƒ¨ç½²é…ç½®
yaml
# docker-compose.prod.yml
version: '3.8'

services:
  backend:
    build:
      context: ./server
      dockerfile: Dockerfile.prod
    environment:
      NODE_ENV: production
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: ${REDIS_URL}
      JWT_SECRET: ${JWT_SECRET}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
      LOG_LEVEL: info
      SENTRY_DSN: ${SENTRY_DSN}
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
ç›‘æ§æŒ‡æ ‡
typescript
// éœ€è¦ç›‘æ§çš„å…³é”®æŒ‡æ ‡
const MonitoringMetrics = {
  // ä¸šåŠ¡æŒ‡æ ‡
  business: {
    transactionCount: 'transactions_total',
    transactionAmount: 'transactions_amount_total',
    userActivity: 'active_users_total',
    
    // é”™è¯¯ç‡
    errorRate: 'error_rate',
    
    // å“åº”æ—¶é—´
    responseTime: 'response_time_seconds',
  },
  
  // ç³»ç»ŸæŒ‡æ ‡
  system: {
    cpuUsage: 'cpu_usage_percent',
    memoryUsage: 'memory_usage_bytes',
    diskUsage: 'disk_usage_percent',
    
    // æ•°æ®åº“
    dbConnections: 'db_connections_total',
    dbQueryTime: 'db_query_time_seconds',
    
    // Redis
    redisHitRate: 'redis_hit_rate',
    redisMemory: 'redis_memory_usage_bytes',
  },
  
  // è­¦æŠ¥è§„åˆ™
  alerts: [
    {
      alert: 'HighErrorRate',
      expr: 'rate(error_total[5m]) > 0.1',
      for: '5m',
      labels: { severity: 'critical' },
      annotations: {
        summary: 'é”™è¯¯ç‡è¿‡é«˜',
        description: 'æœ€è¿‘5åˆ†é’Ÿé”™è¯¯ç‡è¶…è¿‡10%'
      }
    },
    {
      alert: 'SlowResponseTime',
      expr: 'histogram_quantile(0.95, rate(response_time_seconds_bucket[5m])) > 1',
      for: '10m',
      labels: { severity: 'warning' },
      annotations: {
        summary: 'å“åº”æ—¶é—´è¿‡æ…¢',
        description: '95%çš„è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡1ç§’'
      }
    }
  ]
};
10. éªŒæ”¶æ ‡å‡†
åŠŸèƒ½éªŒæ”¶æ¸…å•
markdown
- [ ] åŠŸèƒ½å®Œæ•´å®ç°æ‰€æœ‰éœ€æ±‚
- [ ] ç•Œé¢ç¬¦åˆè®¾è®¡è§„èŒƒ
- [ ] å“åº”å¼è®¾è®¡é€‚é…æ‰€æœ‰è®¾å¤‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] å®‰å…¨æ€§è¦æ±‚æ»¡è¶³
- [ ] ä»£ç è´¨é‡åˆæ ¼
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- [ ] æ–‡æ¡£å®Œæ•´å‡†ç¡®
- [ ] æ— å·²çŸ¥é‡å¤§bug
- [ ] ç”¨æˆ·ä½“éªŒè‰¯å¥½
ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•
bash
# è¿è¡Œä»£ç æ£€æŸ¥
npm run lint             # ESLintæ£€æŸ¥
npm run type-check       # TypeScriptç±»å‹æ£€æŸ¥
npm run test:coverage    # æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
npm run build            # æ„å»ºæ£€æŸ¥
npm run audit            # å®‰å…¨å®¡è®¡

å®Œå–„çš„AIåŠŸèƒ½é›†æˆä¸ä»£ç å®¡æŸ¥è§„èŒƒ
ğŸ¤– AIåŠŸèƒ½é›†æˆè§„èŒƒ
1. AIåŠŸèƒ½æ¦‚è§ˆ
AIè¦è§£å†³çš„å…·ä½“é—®é¢˜æ¸…å•
åŠŸèƒ½æ¨¡å—	AIè¦è§£å†³çš„é—®é¢˜	æŠ€æœ¯æ–¹æ¡ˆ	é¢„æœŸæ•ˆæœ
æ™ºèƒ½åˆ†ç±»	äº¤æ˜“æè¿°è‡ªåŠ¨åˆ†ç±»	DeepSeek NLP + è§„åˆ™å¼•æ“	å‡†ç¡®ç‡ > 85%ï¼Œç”¨æˆ·ä¿®æ­£åå­¦ä¹ 
è¯­éŸ³è®°è´¦	è¯­éŸ³è½¬æ–‡å­—+æ„å›¾è¯†åˆ«	è¯­éŸ³è¯†åˆ« + NLPå¤„ç†	è¯­éŸ³è¯†åˆ«å‡†ç¡®ç‡ > 90%ï¼Œæ„å›¾è¯†åˆ« > 80%
å›¾ç‰‡è¯†åˆ«	è´¦å•å›¾ç‰‡æ–‡å­—æå–	OCR + æ•°æ®ç»“æ„åŒ–	ç¥¨æ®å…³é”®ä¿¡æ¯æå–å‡†ç¡®ç‡ > 95%
è´¢åŠ¡åˆ†æ	æ¶ˆè´¹ä¹ æƒ¯åˆ†æå»ºè®®	æ•°æ®åˆ†æ + æ¨¡å¼è¯†åˆ«	æä¾›ä¸ªæ€§åŒ–ã€å¯æ‰§è¡Œçš„è´¢åŠ¡å»ºè®®
æ™ºèƒ½é—®ç­”	è‡ªç„¶è¯­è¨€è´¢åŠ¡æŸ¥è¯¢	NLP + çŸ¥è¯†å›¾è°±	å›ç­”å‡†ç¡®ç‡ > 90%ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢
å¼‚å¸¸æ£€æµ‹	å¼‚å¸¸æ¶ˆè´¹æ¨¡å¼è¯†åˆ«	æœºå™¨å­¦ä¹ å¼‚å¸¸æ£€æµ‹	å¼‚å¸¸æ£€æµ‹å‡†ç¡®ç‡ > 85%ï¼Œä½è¯¯æŠ¥
é¢„ç®—ä¼˜åŒ–	æ™ºèƒ½é¢„ç®—åˆ†é…å»ºè®®	å¼ºåŒ–å­¦ä¹  + å†å²æ•°æ®	é¢„ç®—åˆ†é…åˆç†åº¦æå‡ > 20%
æŠ¥å‘Šç”Ÿæˆ	è‡ªåŠ¨ç”Ÿæˆè´¢åŠ¡æŠ¥å‘Š	LLM + æ¨¡æ¿å¼•æ“	æŠ¥å‘Šè´¨é‡æ¥è¿‘äººå·¥æ°´å¹³
2. è¯¦ç»†AIåŠŸèƒ½æè¿°
2.1 æ™ºèƒ½åˆ†ç±»åŠŸèƒ½
é—®é¢˜æè¿°ï¼š
ç”¨æˆ·è¾“å…¥äº¤æ˜“æè¿°ï¼ˆå¦‚"æ˜Ÿå·´å…‹å’–å•¡"ï¼‰ï¼ŒAIéœ€è¦ï¼š

è‡ªåŠ¨è¯†åˆ«æœ€åˆé€‚çš„åˆ†ç±»ï¼ˆé¤é¥®ã€äº¤é€šç­‰ï¼‰

æä¾›å¤‡é€‰åˆ†ç±»å»ºè®®

è¯†åˆ«å¯èƒ½çš„æ ‡ç­¾ï¼ˆå¦‚"å’–å•¡"ã€"æ—©é¤"ï¼‰

è¯†åˆ«å¯èƒ½çš„å•†å®¶ä¿¡æ¯

æŠ€æœ¯å®ç°ï¼š

typescript
interface ClassificationRequest {
  description: string;
  amount?: number;
  context?: {
    location?: string;
    time?: string;
    historicalCategories?: string[];
  };
}

interface ClassificationResponse {
  primaryCategory: {
    id: string;
    name: string;
    confidence: number; // 0-1
    reasoning: string;
  };
  alternativeCategories: Array<{
    id: string;
    name: string;
    confidence: number;
  }>;
  extractedTags: string[];
  extractedEntities: {
    merchant?: string;
    location?: string;
    time?: string;
  };
  metadata: {
    modelVersion: string;
    processingTime: number;
    cacheHit: boolean;
  };
}
æç¤ºè¯è®¾è®¡ï¼š

javascript
const classificationPrompt = `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è´¢åŠ¡åˆ†ç±»åŠ©æ‰‹ï¼Œä¸“é—¨åˆ†ææ¶ˆè´¹æè¿°å¹¶å½’ç±»ã€‚

## ä»»åŠ¡è¦æ±‚
åˆ†æä»¥ä¸‹æ¶ˆè´¹æè¿°ï¼Œä»ç”¨æˆ·åˆ†ç±»ä¸­é€‰æ‹©æœ€åˆé€‚çš„åˆ†ç±»ã€‚

## ç”¨æˆ·åˆ†ç±»ä½“ç³»
{ç”¨æˆ·åˆ†ç±»åˆ—è¡¨ï¼Œæ ¼å¼ï¼šåˆ†ç±»ID:åˆ†ç±»åç§°(ç±»å‹)}

## è¾“å…¥æ•°æ®
- æè¿°ï¼š{description}
- é‡‘é¢ï¼š{amount}
- æ—¶é—´ï¼š{time}
- ä½ç½®ï¼š{location}

## å†å²å‚è€ƒ
ç”¨æˆ·å†å²åå¥½åˆ†ç±»ï¼š{historicalCategories}

## è¾“å‡ºè¦æ±‚
è¿”å›ä¸¥æ ¼çš„JSONæ ¼å¼ï¼š
{
  "primaryCategory": {
    "id": "åˆ†ç±»ID",
    "name": "åˆ†ç±»åç§°",
    "confidence": 0.95,
    "reasoning": "ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªåˆ†ç±»ï¼Œè¯´æ˜å…³é”®è¯åŒ¹é…ã€æ¨¡å¼è¯†åˆ«ç­‰"
  },
  "alternativeCategories": [
    {
      "id": "å¤‡é€‰åˆ†ç±»ID",
      "name": "å¤‡é€‰åˆ†ç±»åç§°",
      "confidence": 0.8
    }
  ],
  "extractedTags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "extractedEntities": {
    "merchant": "å•†å®¶åç§°ï¼ˆå¦‚è¯†åˆ«åˆ°ï¼‰",
    "location": "åœ°ç‚¹ï¼ˆå¦‚è¯†åˆ«åˆ°ï¼‰",
    "time": "æ—¶é—´ä¿¡æ¯ï¼ˆå¦‚è¯†åˆ«åˆ°ï¼‰"
  }
}

## æ³¨æ„äº‹é¡¹
1. ç½®ä¿¡åº¦å¿…é¡»åœ¨0-1ä¹‹é—´ï¼Œå°æ•°ç‚¹åä¸¤ä½
2. å¦‚æœæ²¡æœ‰è¯†åˆ«åˆ°å®ä½“ï¼Œå¯¹åº”å­—æ®µä¸ºnull
3. reasoningè¦å…·ä½“è¯´æ˜åŒ¹é…çš„å…³é”®è¯æˆ–æ¨¡å¼
4. å¦‚æœæè¿°æ¨¡ç³Šï¼Œé™ä½ç½®ä¿¡åº¦å¹¶æä¾›å¤šä¸ªå¤‡é€‰
`;
2.2 è´¢åŠ¡åˆ†æåŠŸèƒ½
é—®é¢˜æè¿°ï¼š
åŸºäºç”¨æˆ·å†å²æ•°æ®ï¼Œæä¾›ï¼š

æ¶ˆè´¹ä¹ æƒ¯åˆ†æ

è´¢åŠ¡å¥åº·è¯„åˆ†

ä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®

é£é™©é¢„è­¦

æŠ€æœ¯å®ç°ï¼š

typescript
interface FinancialAnalysisRequest {
  userId: string;
  timeRange: {
    start: string; // ISOæ—¥æœŸ
    end: string;
  };
  analysisType: 'overview' | 'detailed' | 'comparative';
  focusAreas?: string[]; // å¦‚['é¤é¥®', 'äº¤é€š']
}

interface FinancialAnalysisResponse {
  summary: {
    totalIncome: number;
    totalExpense: number;
    netSavings: number;
    savingRate: number; // ç™¾åˆ†æ¯”
    averageDailySpending: number;
  };
  
  financialHealth: {
    score: number; // 0-100
    level: 'excellent' | 'good' | 'fair' | 'poor' | 'critical';
    breakdown: {
      spendingHabits: number;
      savingRate: number;
      budgetAdherence: number;
      incomeStability: number;
    };
  };
  
  insights: Array<{
    type: 'positive' | 'warning' | 'critical';
    title: string;
    description: string;
    data: any; // æ”¯æŒæ•°æ®
    recommendation?: string;
    priority: 'low' | 'medium' | 'high';
  }>;
  
  trends: {
    spendingByCategory: Record<string, number>;
    monthlyComparison: Array<{
      month: string;
      income: number;
      expense: number;
      difference: number;
    }>;
    topSpendingDays: Array<{
      date: string;
      amount: number;
      category: string;
    }>;
  };
  
  recommendations: Array<{
    category: string;
    currentSpending: number;
    suggestedSpending: number;
    potentialSavings: number;
    actionSteps: string[];
    expectedImpact: string;
  }>;
}
3. DeepSeek APIé›†æˆè§„èŒƒ
3.1 APIè°ƒç”¨é…ç½®
typescript
interface DeepSeekConfig {
  // åŸºç¡€é…ç½®
  baseUrl: string;
  apiKey: string;
  timeout: number; // æ¯«ç§’
  maxRetries: number;
  
  // æ¨¡å‹é…ç½®
  defaultModel: 'deepseek-chat';
  availableModels: {
    'deepseek-chat': { contextLength: 16384 };
    'deepseek-coder': { contextLength: 16384 };
  };
  
  // æ¸©åº¦é…ç½®ï¼ˆæ ¹æ®ä¸åŒä»»åŠ¡ç±»å‹ï¼‰
  temperaturePresets: {
    precise: 0.2;    // åˆ†ç±»ã€è®¡ç®—ç­‰ç²¾ç¡®ä»»åŠ¡
    balanced: 0.5;   // åˆ†æã€å»ºè®®ç­‰å¹³è¡¡ä»»åŠ¡
    creative: 0.7;   // ç”Ÿæˆã€åˆ›æ„ä»»åŠ¡
  };
  
  // æœ€å¤§tokené…ç½®
  maxTokens: {
    classification: 500;
    analysis: 2000;
    generation: 4000;
  };
  
  // é€Ÿç‡é™åˆ¶
  rateLimit: {
    requestsPerMinute: 60;
    tokensPerMinute: 60000;
  };
}

// å…·ä½“å®ç°ç±»
class DeepSeekService {
  private config: DeepSeekConfig;
  private cache: CacheService;
  private metrics: MetricsService;
  private fallbackStrategies: FallbackStrategy[];
  
  async callApi<T>(
    prompt: string,
    options: {
      model?: string;
      temperature?: number;
      maxTokens?: number;
      useCache?: boolean;
      cacheKey?: string;
      fallbackEnabled?: boolean;
    } = {}
  ): Promise<T> {
    const startTime = Date.now();
    
    try {
      // 1. æ£€æŸ¥ç¼“å­˜
      if (options.useCache && options.cacheKey) {
        const cached = await this.cache.get<T>(options.cacheKey);
        if (cached) {
          this.metrics.recordCacheHit();
          return cached;
        }
      }
      
      // 2. æ„å»ºè¯·æ±‚
      const requestPayload = {
        model: options.model || this.config.defaultModel,
        messages: [
          {
            role: 'system',
            content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è´¢åŠ¡åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†ä¸ªäººè´¢åŠ¡ã€‚'
          },
          {
            role: 'user',
            content: prompt
          }
        ],
        temperature: options.temperature || this.config.temperaturePresets.balanced,
        max_tokens: options.maxTokens || this.config.maxTokens.analysis,
        stream: false
      };
      
      // 3. å‘é€è¯·æ±‚ï¼ˆå¸¦é‡è¯•ï¼‰
      const response = await this.executeWithRetry(
        () => axios.post(this.config.baseUrl, requestPayload, {
          headers: {
            'Authorization': `Bearer ${this.config.apiKey}`,
            'Content-Type': 'application/json'
          },
          timeout: this.config.timeout
        }),
        this.config.maxRetries
      );
      
      // 4. è§£æå“åº”
      const result = this.parseResponse<T>(response.data);
      
      // 5. éªŒè¯ç»“æœ
      this.validateResult(result);
      
      // 6. ç¼“å­˜ç»“æœ
      if (options.useCache && options.cacheKey) {
        await this.cache.set(
          options.cacheKey,
          result,
          this.calculateCacheTTL(result)
        );
      }
      
      // 7. è®°å½•æŒ‡æ ‡
      this.metrics.recordApiCall({
        duration: Date.now() - startTime,
        tokensUsed: response.data.usage?.total_tokens || 0,
        model: requestPayload.model,
        success: true
      });
      
      return result;
      
    } catch (error) {
      // é”™è¯¯å¤„ç†
      this.metrics.recordApiCall({
        duration: Date.now() - startTime,
        error: error.message,
        success: false
      });
      
      // é™çº§ç­–ç•¥
      if (options.fallbackEnabled) {
        return this.executeFallbackStrategy(prompt);
      }
      
      throw new AiServiceError(
        'AIæœåŠ¡è°ƒç”¨å¤±è´¥',
        error,
        { prompt, options }
      );
    }
  }
}
3.2 æç¤ºè¯è®¾è®¡è§„èŒƒ
typescript
// æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ
class PromptTemplate {
  private templates: Map<string, string>;
  
  constructor() {
    this.templates = new Map();
    this.registerTemplates();
  }
  
  private registerTemplates() {
    // åˆ†ç±»æ¨¡æ¿
    this.templates.set('classification', `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è´¢åŠ¡åˆ†ç±»åŠ©æ‰‹ã€‚è¯·åˆ†æä»¥ä¸‹æ¶ˆè´¹æè¿°å¹¶å½’ç±»ã€‚

## ç”¨æˆ·åˆ†ç±»ä½“ç³»
{{categories}}

## è¾“å…¥ä¿¡æ¯
- æè¿°ï¼š{{description}}
- é‡‘é¢ï¼š{{amount}}å…ƒ
- æ—¶é—´ï¼š{{time}}
- åœ°ç‚¹ï¼š{{location}}

## ç”¨æˆ·å†å²åå¥½
{{#if historicalData}}
æœ€è¿‘å¸¸ç”¨çš„åˆ†ç±»ï¼š{{historicalData.frequentCategories}}
æœ€è¿‘ä½¿ç”¨çš„æ ‡ç­¾ï¼š{{historicalData.recentTags}}
{{/if}}

## è¾“å‡ºè¦æ±‚
{{formatInstructions}}

## æ³¨æ„äº‹é¡¹
1. è€ƒè™‘ç”¨æˆ·çš„æ¶ˆè´¹ä¹ æƒ¯å’Œå†å²åå¥½
2. å¦‚æœæè¿°æ¨¡ç³Šï¼Œæä¾›å¤šä¸ªå¯èƒ½çš„åˆ†ç±»
3. ä»æè¿°ä¸­æå–æœ‰ç”¨çš„æ ‡ç­¾
4. ç½®ä¿¡åº¦è¦åæ˜ åˆ¤æ–­çš„ç¡®å®šæ€§
    `);
    
    // åˆ†ææ¨¡æ¿
    this.templates.set('financial_analysis', `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è´¢åŠ¡é¡¾é—®ã€‚è¯·åˆ†æä»¥ä¸‹è´¢åŠ¡æ•°æ®å¹¶æä¾›å»ºè®®ã€‚

## ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- æ”¶å…¥æ°´å¹³ï¼š{{incomeLevel}}
- ä¸»è¦æ”¶å…¥æ¥æºï¼š{{incomeSources}}
- å‚¨è“„ç›®æ ‡ï¼š{{savingGoals}}

## æ¶ˆè´¹æ•°æ®ï¼ˆ{{period}}ï¼‰
{{#each spendingByCategory}}
- {{category}}: {{amount}}å…ƒ ({{percentage}}%)
{{/each}}

## é¢„ç®—æ‰§è¡Œæƒ…å†µ
{{#each budgetStatus}}
- {{category}}: é¢„ç®—{{budget}}å…ƒï¼Œå®é™…{{actual}}å…ƒï¼Œå®Œæˆåº¦{{completion}}%
{{/each}}

## ç”¨æˆ·ç‰¹æ®Šè¦æ±‚
{{userRequirements}}

## è¾“å‡ºè¦æ±‚
{{formatInstructions}}

## åˆ†æè¦ç‚¹
1. è¯†åˆ«è¿‡åº¦æ¶ˆè´¹çš„ç±»åˆ«
2. è¯„ä¼°å‚¨è“„ç›®æ ‡çš„å¯è¾¾æ€§
3. æä¾›å…·ä½“çš„è¡ŒåŠ¨å»ºè®®
4. è€ƒè™‘ç”¨æˆ·çš„æ”¶å…¥æ°´å¹³å’Œç”Ÿæ´»é˜¶æ®µ
    `);
  }
  
  // æ¨¡æ¿æ¸²æŸ“
  render(templateName: string, data: any, options?: {
    format?: 'json' | 'text';
    instructions?: string;
  }): string {
    const template = this.templates.get(templateName);
    if (!template) {
      throw new Error(`Template ${templateName} not found`);
    }
    
    // ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¸²æŸ“
    const rendered = this.compile(template, data);
    
    // æ·»åŠ æ ¼å¼æŒ‡ä»¤
    const formatInstructions = options?.format === 'json' 
      ? this.getJsonFormatInstructions(options.instructions)
      : this.getTextFormatInstructions(options.instructions);
    
    return rendered + '\n\n' + formatInstructions;
  }
  
  private getJsonFormatInstructions(schema?: string): string {
    return `
## è¾“å‡ºæ ¼å¼è¦æ±‚
è¿”å›ä¸¥æ ¼çš„JSONæ ¼å¼ï¼Œç¬¦åˆä»¥ä¸‹schemaï¼š
${schema || this.getDefaultSchema()}

## æ ¼å¼è§„åˆ™
1. å¿…é¡»æ˜¯æœ‰æ•ˆçš„JSON
2. æ‰€æœ‰æ•°å­—ä½¿ç”¨numberç±»å‹
3. æ‰€æœ‰å­—ç¬¦ä¸²ä½¿ç”¨åŒå¼•å·
4. ä¸å…è®¸æœ‰æ³¨é‡Š
5. ä¸å…è®¸æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œ
    `;
  }
}
3.3 é”™è¯¯å¤„ç†ç­–ç•¥
typescript
// å®Œæ•´çš„é”™è¯¯å¤„ç†ä½“ç³»
class AiErrorHandler {
  
  // é”™è¯¯åˆ†ç±»
  static readonly ErrorTypes = {
    API_ERROR: 'api_error',
    RATE_LIMIT: 'rate_limit',
    TIMEOUT: 'timeout',
    INVALID_RESPONSE: 'invalid_response',
    CONTENT_FILTER: 'content_filter',
    MODEL_OVERLOAD: 'model_overload'
  };
  
  // é”™è¯¯å¤„ç†ç­–ç•¥
  private strategies: Map<string, ErrorHandlerStrategy> = new Map();
  
  constructor() {
    this.initStrategies();
  }
  
  private initStrategies() {
    // 1. é‡è¯•ç­–ç•¥ï¼ˆé€‚ç”¨äºä¸´æ—¶æ€§é”™è¯¯ï¼‰
    this.strategies.set('retry', {
      name: 'retry_with_backoff',
      canHandle: (error) => this.isRetryableError(error),
      execute: async (operation, context) => {
        const maxRetries = 3;
        let lastError;
        
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
          try {
            const backoff = this.calculateBackoff(attempt);
            await this.sleep(backoff);
            
            return await operation();
          } catch (error) {
            lastError = error;
            
            if (!this.isRetryableError(error) || attempt === maxRetries) {
              break;
            }
            
            this.logRetryAttempt(attempt, error, context);
          }
        }
        
        throw lastError;
      }
    });
    
    // 2. é™çº§ç­–ç•¥ï¼ˆè¿”å›ç®€åŒ–ç»“æœï¼‰
    this.strategies.set('fallback', {
      name: 'simplified_fallback',
      canHandle: (error) => true, // æ€»æ˜¯å¯ä»¥é™çº§
      execute: async (operation, context) => {
        try {
          // å°è¯•ä½¿ç”¨ç®€åŒ–æ¨¡å‹æˆ–è§„åˆ™å¼•æ“
          return await this.simplifiedAnalysis(context);
        } catch (fallbackError) {
          // å¦‚æœé™çº§ä¹Ÿå¤±è´¥ï¼Œè¿”å›é¢„å®šä¹‰çš„ç»“æœ
          return this.getDefaultResult(context);
        }
      }
    });
    
    // 3. ç¼“å­˜ç­–ç•¥ï¼ˆè¿”å›æœ€è¿‘çš„ç¼“å­˜ç»“æœï¼‰
    this.strategies.set('cache_fallback', {
      name: 'cached_response',
      canHandle: (error) => this.hasRecentCache(context),
      execute: async (operation, context) => {
        const cached = await this.cacheService.getRecentSimilar(
          context.cacheKey,
          { maxAge: 24 * 60 * 60 * 1000 } // 24å°æ—¶å†…çš„ç¼“å­˜
        );
        
        if (cached) {
          this.logger.warn('ä½¿ç”¨ç¼“å­˜ç»“æœä½œä¸ºé™çº§', {
            cacheAge: cached.age,
            context
          });
          
          return cached.data;
        }
        
        throw new Error('No cached result available');
      }
    });
  }
  
  // æ™ºèƒ½é”™è¯¯è·¯ç”±
  async handleError<T>(
    error: any,
    context: ErrorContext,
    operation: () => Promise<T>
  ): Promise<T> {
    // 1. è®°å½•é”™è¯¯
    this.logError(error, context);
    
    // 2. è¯†åˆ«é”™è¯¯ç±»å‹
    const errorType = this.classifyError(error);
    
    // 3. é€‰æ‹©å¤„ç†ç­–ç•¥ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
    const strategies = this.getApplicableStrategies(errorType, context);
    
    // 4. æŒ‰é¡ºåºå°è¯•ç­–ç•¥
    for (const strategy of strategies) {
      try {
        const result = await strategy.execute(operation, context);
        
        // è®°å½•é™çº§æˆåŠŸ
        this.metrics.recordFallbackSuccess(strategy.name);
        
        return result;
      } catch (strategyError) {
        // ç­–ç•¥å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ª
        continue;
      }
    }
    
    // 5. æ‰€æœ‰ç­–ç•¥éƒ½å¤±è´¥ï¼ŒæŠ›å‡ºæœ€ç»ˆé”™è¯¯
    throw this.wrapFinalError(error, context);
  }
}

// é”™è¯¯ç›‘æ§å’ŒæŠ¥è­¦
class AiErrorMonitor {
  private metrics: Map<string, ErrorMetrics> = new Map();
  private alertRules: AlertRule[] = [];
  
  constructor() {
    this.setupAlertRules();
  }
  
  private setupAlertRules() {
    this.alertRules = [
      {
        name: 'high_error_rate',
        condition: (metrics) => {
          const window = metrics.getWindow('1h');
          return window.errorRate > 0.1; // 10%é”™è¯¯ç‡
        },
        action: async (metrics) => {
          // å‘é€è­¦æŠ¥
          await this.sendAlert({
            severity: 'critical',
            title: 'AIæœåŠ¡é”™è¯¯ç‡è¿‡é«˜',
            message: `è¿‡å»1å°æ—¶é”™è¯¯ç‡${metrics.errorRate.toFixed(2)}%`,
            data: metrics
          });
          
          // è‡ªåŠ¨è§¦å‘è¯Šæ–­
          await this.triggerDiagnostics();
        }
      },
      {
        name: 'response_time_degradation',
        condition: (metrics) => {
          const current = metrics.getWindow('5m');
          const baseline = metrics.getBaseline();
          return current.avgResponseTime > baseline.avgResponseTime * 2;
        },
        action: async (metrics) => {
          await this.sendAlert({
            severity: 'warning',
            title: 'AIæœåŠ¡å“åº”æ—¶é—´ä¸‹é™',
            message: `å½“å‰å“åº”æ—¶é—´${current.avgResponseTime}msï¼Œæ¯”åŸºçº¿é«˜100%`
          });
        }
      }
    ];
  }
  
  recordError(error: AiError) {
    const key = this.getErrorKey(error);
    const metrics = this.metrics.get(key) || new ErrorMetrics();
    
    metrics.record(error);
    this.metrics.set(key, metrics);
    
    // æ£€æŸ¥è­¦æŠ¥è§„åˆ™
    this.checkAlerts(metrics);
    
    // è‡ªåŠ¨è°ƒæ•´ç­–ç•¥
    this.adjustStrategyBasedOnErrors(error);
  }
}
3.4 ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
typescript
class AiCacheManager {
  private redis: Redis;
  private localCache: Map<string, CacheEntry>;
  private readonly cacheLayers = ['local', 'redis', 'persistent'];
  
  constructor() {
    this.setupCacheLayers();
  }
  
  private setupCacheLayers() {
    // ä¸‰å±‚ç¼“å­˜æ¶æ„
    this.localCache = new Map(); // å†…å­˜ç¼“å­˜ï¼Œæœ€å¿«
    this.redis = new Redis(/* é…ç½® */); // åˆ†å¸ƒå¼ç¼“å­˜
    // persistent å±‚å¯ä»¥æ˜¯æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿ
  }
  
  // æ™ºèƒ½ç¼“å­˜é”®ç”Ÿæˆ
  generateCacheKey(
    template: string,
    data: any,
    options: CacheKeyOptions
  ): string {
    // 1. åŸºç¡€é”®
    const baseKey = `ai:${template}:${options.model || 'default'}`;
    
    // 2. æ•°æ®å“ˆå¸Œï¼ˆæ’é™¤ä¸ç¨³å®šçš„å­—æ®µï¼‰
    const stableData = this.extractStableFields(data);
    const dataHash = this.hashObject(stableData);
    
    // 3. ç”¨æˆ·ä¸Šä¸‹æ–‡
    const userContext = options.userId 
      ? `:user:${options.userId}` 
      : ':anonymous';
    
    // 4. ç‰ˆæœ¬æ ‡è¯†
    const version = options.version || 'v1';
    
    return `${baseKey}:${dataHash}${userContext}:${version}`;
  }
  
  // è‡ªé€‚åº”TTLè®¡ç®—
  calculateTTL(result: any, context: CacheContext): number {
    const baseTTL = 5 * 60; // 5åˆ†é’ŸåŸºç¡€TTL
    
    // æ ¹æ®ç½®ä¿¡åº¦è°ƒæ•´
    const confidence = result.confidence || 0.5;
    const confidenceMultiplier = Math.max(0.5, confidence);
    
    // æ ¹æ®ä½¿ç”¨é¢‘ç‡è°ƒæ•´
    const frequency = this.getAccessFrequency(context.key);
    const frequencyMultiplier = frequency > 10 ? 2 : 1;
    
    // æ ¹æ®æ•°æ®æ–°é²œåº¦è¦æ±‚è°ƒæ•´
    const freshnessRequirement = context.freshness || 'standard';
    const freshnessMultiplier = {
      'high': 0.2,    // è¦æ±‚é«˜æ–°é²œåº¦ï¼ŒTTLç¼©çŸ­
      'standard': 1,  // æ ‡å‡†æ–°é²œåº¦
      'low': 5        // å¯æ¥å—è¾ƒæ—§æ•°æ®ï¼ŒTTLå»¶é•¿
    }[freshnessRequirement];
    
    return baseTTL * confidenceMultiplier * frequencyMultiplier * freshnessMultiplier;
  }
  
  // ç¼“å­˜é¢„çƒ­æœºåˆ¶
  async warmUpCache(userId: string): Promise<void> {
    const userPatterns = await this.analyzeUserPatterns(userId);
    
    const warmUpTasks = userPatterns.map(pattern => {
      return this.precachePattern(pattern, userId);
    });
    
    // å¹¶å‘é¢„çƒ­ï¼Œä½†æ§åˆ¶å¹¶å‘æ•°
    await this.executeWithConcurrency(warmUpTasks, 3);
  }
  
  private async precachePattern(pattern: UserPattern, userId: string) {
    // åŸºäºç”¨æˆ·æ¨¡å¼é¢„æµ‹å¯èƒ½çš„æŸ¥è¯¢
    const likelyQueries = this.predictQueriesFromPattern(pattern);
    
    for (const query of likelyQueries) {
      try {
        // å¼‚æ­¥é¢„å–ç»“æœ
        const result = await this.aiService.process(query, { userId });
        
        // ç¼“å­˜ç»“æœï¼Œè®¾ç½®è¾ƒé•¿TTL
        await this.set(
          this.generateCacheKey('prediction', query, { userId }),
          result,
          { ttl: 30 * 60 } // 30åˆ†é’Ÿ
        );
      } catch (error) {
        // é¢„çƒ­å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
        this.logger.debug('é¢„çƒ­ç¼“å­˜å¤±è´¥', { error, query });
      }
    }
  }
  
  // ç¼“å­˜å¤±æ•ˆç­–ç•¥
  async invalidateRelatedCaches(entityType: string, entityId: string) {
    const patterns = [
      `${entityType}:${entityId}:*`,
      `*:${entityId}:*`,
      `user:*:${entityType}:${entityId}`
    ];
    
    for (const pattern of patterns) {
      await this.redis.delPattern(pattern);
    }
    
    // æ¸…ç†æœ¬åœ°ç¼“å­˜
    this.clearLocalCacheByPattern(pattern);
  }
}
3.5 å­¦ä¹ ä¸ä¼˜åŒ–æœºåˆ¶
typescript
class AiLearningSystem {
  private feedbackStore: FeedbackStore;
  private modelOptimizer: ModelOptimizer;
  private experimentManager: ExperimentManager;
  
  // ç”¨æˆ·åé¦ˆæ”¶é›†
  async collectFeedback(
    request: AiRequest,
    response: AiResponse,
    userFeedback: UserFeedback
  ): Promise<void> {
    const feedbackRecord: FeedbackRecord = {
      id: uuid(),
      timestamp: new Date(),
      request: this.sanitizeRequest(request),
      originalResponse: response,
      userFeedback,
      corrections: userFeedback.corrections,
      rating: userFeedback.rating,
      metadata: {
        userId: request.userId,
        sessionId: request.sessionId,
        modelVersion: response.metadata?.modelVersion
      }
    };
    
    // å­˜å‚¨åé¦ˆ
    await this.feedbackStore.save(feedbackRecord);
    
    // å®æ—¶åˆ†æåé¦ˆ
    await this.analyzeFeedback(feedbackRecord);
    
    // å¦‚æœåé¦ˆæ˜¯çº æ­£ï¼Œæ›´æ–°å­¦ä¹ æ•°æ®
    if (userFeedback.corrections) {
      await this.updateLearningData(feedbackRecord);
    }
  }
  
  // æ¨¡å‹ä¼˜åŒ–å»ºè®®
  async generateOptimizationSuggestions(): Promise<OptimizationSuggestion[]> {
    const suggestions: OptimizationSuggestion[] = [];
    
    // 1. åˆ†æé”™è¯¯æ¨¡å¼
    const errorPatterns = await this.analyzeErrorPatterns();
    suggestions.push(...this.getSuggestionsFromErrors(errorPatterns));
    
    // 2. åˆ†æç”¨æˆ·åé¦ˆ
    const feedbackAnalysis = await this.analyzeUserFeedback();
    suggestions.push(...this.getSuggestionsFromFeedback(feedbackAnalysis));
    
    // 3. åˆ†ææ€§èƒ½æ•°æ®
    const performanceData = await this.analyzePerformance();
    suggestions.push(...this.getSuggestionsFromPerformance(performanceData));
    
    // æŒ‰ä¼˜å…ˆçº§æ’åº
    return suggestions.sort((a, b) => {
      const priorityScore = (s: OptimizationSuggestion) => {
        return s.expectedImpact * s.confidence * (s.implementationComplexity ? 1/s.implementationComplexity : 1);
      };
      
      return priorityScore(b) - priorityScore(a);
    });
  }
  
  // A/Bæµ‹è¯•æ¡†æ¶
  class ABTestManager {
    private experiments: Map<string, Experiment> = new Map();
    private assignmentStrategy: AssignmentStrategy;
    
    // åˆ›å»ºå®éªŒ
    async createExperiment(config: ExperimentConfig): Promise<string> {
      const experimentId = uuid();
      
      const experiment: Experiment = {
        id: experimentId,
        name: config.name,
        description: config.description,
        startDate: new Date(),
        status: 'active',
        variants: config.variants,
        metrics: config.metrics,
        assignment: {
          strategy: config.assignmentStrategy || 'random',
          weights: config.variantWeights || {}
        },
        targetAudience: config.targetAudience,
        exclusionGroups: config.exclusionGroups || []
      };
      
      this.experiments.set(experimentId, experiment);
      
      // åˆå§‹åŒ–æ•°æ®æ”¶é›†
      await this.initExperimentTracking(experimentId);
      
      return experimentId;
    }
    
    // åˆ†é…å˜ä½“
    assignVariant(
      experimentId: string,
      userId: string,
      context: AssignmentContext
    ): string {
      const experiment = this.experiments.get(experimentId);
      if (!experiment || experiment.status !== 'active') {
        return 'control'; // é»˜è®¤è¿”å›æ§åˆ¶ç»„
      }
      
      // æ£€æŸ¥æ’é™¤æ¡ä»¶
      if (this.shouldExclude(userId, experiment)) {
        return 'control';
      }
      
      // åº”ç”¨åˆ†é…ç­–ç•¥
      switch (experiment.assignment.strategy) {
        case 'random':
          return this.assignRandom(experiment);
        case 'weighted':
          return this.assignWeighted(experiment);
        case 'contextual':
          return this.assignContextual(experiment, context);
        case 'bandit':
          return this.assignBandit(experiment, userId);
        default:
          return 'control';
      }
    }
    
    // åˆ†æå®éªŒç»“æœ
    async analyzeExperiment(experimentId: string): Promise<ExperimentResult> {
      const experiment = this.experiments.get(experimentId);
      if (!experiment) {
        throw new Error(`Experiment ${experimentId} not found`);
      }
      
      // æ”¶é›†æ‰€æœ‰æŒ‡æ ‡æ•°æ®
      const metricsData = await this.collectMetricsData(experimentId);
      
      // ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ
      const results = this.calculateStatisticalSignificance(metricsData);
      
      // ç”ŸæˆæŠ¥å‘Š
      const report: ExperimentResult = {
        experimentId,
        analysisDate: new Date(),
        totalParticipants: this.calculateTotalParticipants(metricsData),
        durationDays: this.calculateDuration(experiment),
        results,
        recommendations: this.generateRecommendations(results),
        confidenceLevel: this.calculateConfidence(results),
        rawData: metricsData
      };
      
      // è‡ªåŠ¨å†³ç­–ï¼ˆå¯é€‰ï¼‰
      if (experiment.autoDecide && report.confidenceLevel > 0.95) {
        await this.implementWinningVariant(experimentId, report);
      }
      
      return report;
    }
  }
}
ğŸ” ä»£ç å®¡æŸ¥è§„èŒƒï¼ˆå®Œæ•´ç‰ˆï¼‰
1. ä»£ç å®¡æŸ¥æµç¨‹
å®¡æŸ¥æµç¨‹è®¾è®¡
typescript
interface CodeReviewProcess {
  // é˜¶æ®µ1ï¼šè‡ªåŠ¨åŒ–æ£€æŸ¥ï¼ˆæ¯æ¬¡æäº¤è§¦å‘ï¼‰
  automatedChecks: {
    staticAnalysis: boolean;    // é™æ€ä»£ç åˆ†æ
    securityScan: boolean;      // å®‰å…¨æ‰«æ
    testCoverage: boolean;      // æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
    buildValidation: boolean;   // æ„å»ºéªŒè¯
    linting: boolean;           // ä»£ç è§„èŒƒæ£€æŸ¥
  };
  
  // é˜¶æ®µ2ï¼šAIè¾…åŠ©å®¡æŸ¥ï¼ˆè‡ªåŠ¨ç”Ÿæˆå®¡æŸ¥æ„è§ï¼‰
  aiAssistedReview: {
    enabled: boolean;
    focusAreas: Array<'security' | 'performance' | 'maintainability' | 'best-practices'>;
    severityThreshold: 'info' | 'warning' | 'error';
  };
  
  // é˜¶æ®µ3ï¼šäººå·¥å®¡æŸ¥ï¼ˆå¿…è¦æ­¥éª¤ï¼‰
  manualReview: {
    required: boolean;
    requiredApprovals: number;
    reviewTimeout: number; // å°æ—¶
    allowedReviewers: string[]; // è§’è‰²æˆ–ç”¨æˆ·åˆ—è¡¨
  };
  
  // é˜¶æ®µ4ï¼šåˆå¹¶å‰æ£€æŸ¥
  preMergeChecks: {
    conflictCheck: boolean;
    integrationTest: boolean;
    performanceRegression: boolean;
    deployPreview: boolean;
  };
}

// ä»£ç å®¡æŸ¥æ£€æŸ¥è¡¨
const CodeReviewChecklist = {
  // é€šç”¨æ£€æŸ¥é¡¹
  general: [
    { id: 'G001', description: 'ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ', required: true },
    { id: 'G002', description: 'æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯', required: true },
    { id: 'G003', description: 'é€‚å½“çš„ä»£ç æ³¨é‡Š', required: false },
    { id: 'G004', description: 'åˆ é™¤æœªä½¿ç”¨çš„ä»£ç ', required: true },
    { id: 'G005', description: 'ä»£ç å¤æ‚åº¦åˆç†', required: true },
  ],
  
  // å®‰å…¨æ€§æ£€æŸ¥é¡¹
  security: [
    { id: 'S001', description: 'æ— ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯', required: true },
    { id: 'S002', description: 'è¾“å…¥éªŒè¯å’Œæ¸…ç†', required: true },
    { id: 'S003', description: 'SQLæ³¨å…¥é˜²æŠ¤', required: true },
    { id: 'S004', description: 'XSSé˜²æŠ¤', required: true },
    { id: 'S005', description: 'CSRFé˜²æŠ¤', required: true },
    { id: 'S006', description: 'è®¤è¯æˆæƒæ£€æŸ¥', required: true },
    { id: 'S007', description: 'APIé€Ÿç‡é™åˆ¶', required: false },
    { id: 'S008', description: 'æ—¥å¿—ä¸­æ— æ•æ„Ÿä¿¡æ¯', required: true },
  ],
  
  // æ€§èƒ½æ£€æŸ¥é¡¹
  performance: [
    { id: 'P001', description: 'æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–', required: true },
    { id: 'P002', description: 'ç¼“å­˜ç­–ç•¥åˆç†', required: true },
    { id: 'P003', description: 'å†…å­˜æ³„æ¼æ£€æŸ¥', required: true },
    { id: 'P004', description: 'å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ', required: true },
    { id: 'P005', description: 'å‰ç«¯èµ„æºä¼˜åŒ–', required: true },
    { id: 'P006', description: 'APIå“åº”æ—¶é—´åˆç†', required: true },
  ],
  
  // æµ‹è¯•ç›¸å…³æ£€æŸ¥é¡¹
  testing: [
    { id: 'T001', description: 'æœ‰ç›¸åº”çš„å•å…ƒæµ‹è¯•', required: true },
    { id: 'T002', description: 'æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡', required: true },
    { id: 'T003', description: 'è¾¹ç¼˜æƒ…å†µæµ‹è¯•', required: true },
    { id: 'T004', description: 'é›†æˆæµ‹è¯•è¦†ç›–', required: false },
    { id: 'T005', description: 'æµ‹è¯•ä»£ç è´¨é‡', required: true },
  ],
  
  // å¯ç»´æŠ¤æ€§æ£€æŸ¥é¡¹
  maintainability: [
    { id: 'M001', description: 'å•ä¸€èŒè´£åŸåˆ™', required: true },
    { id: 'M002', description: 'ä¾èµ–æ³¨å…¥åˆç†', required: true },
    { id: 'M003', description: 'é…ç½®å¤–éƒ¨åŒ–', required: true },
    { id: 'M004', description: 'é”™è¯¯å¤„ç†å®Œæ•´', required: true },
    { id: 'M005', description: 'æ—¥å¿—è®°å½•é€‚å½“', required: true },
    { id: 'M006', description: 'æ–‡æ¡£å®Œæ•´/æ›´æ–°', required: true },
  ]
};
2. AIè¾…åŠ©ä»£ç å®¡æŸ¥
AIå®¡æŸ¥æç¤ºè¯è®¾è®¡
javascript
const codeReviewPrompt = `
ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆï¼Œæ­£åœ¨è¿›è¡Œä»£ç å®¡æŸ¥ã€‚è¯·ä»”ç»†å®¡æŸ¥ä»¥ä¸‹ä»£ç ã€‚

## å®¡æŸ¥ä»£ç 
æ–‡ä»¶è·¯å¾„ï¼š{{filePath}}
ä»£ç ç±»å‹ï¼š{{codeType}} (å¦‚ï¼šTypeScriptã€Pythonã€SQLç­‰)

\`\`\`{{language}}
{{codeSnippet}}
\`\`\`

## ä¸Šä¸‹æ–‡ä¿¡æ¯
- é¡¹ç›®ç±»å‹ï¼šæ™ºèƒ½è®°è´¦è½¯ä»¶
- æŠ€æœ¯æ ˆï¼š{{techStack}}
- ç›¸å…³PRæè¿°ï¼š{{prDescription}}
- ä¿®æ”¹ç›®çš„ï¼š{{changePurpose}}

## å®¡æŸ¥è¦æ±‚
è¯·ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œå®¡æŸ¥ï¼Œæ¯ä¸ªé—®é¢˜æä¾›ï¼š
1. é—®é¢˜æè¿°
2. ä¸¥é‡ç¨‹åº¦ï¼ˆCritical/High/Medium/Low/Infoï¼‰
3. å½±å“èŒƒå›´
4. å…·ä½“ä¿®æ”¹å»ºè®®
5. æœ€ä½³å®è·µç¤ºä¾‹ï¼ˆå¦‚æœéœ€è¦ï¼‰

## å®¡æŸ¥ç»´åº¦

### 1. å®‰å…¨æ€§å®¡æŸ¥
é‡ç‚¹æ£€æŸ¥ï¼š
- è¾“å…¥éªŒè¯å’Œæ¸…ç†
- SQLæ³¨å…¥é£é™©
- XSSæ¼æ´
- æ•æ„Ÿä¿¡æ¯æ³„éœ²
- è®¤è¯æˆæƒæ¼æ´
- ä¸å®‰å…¨ä¾èµ–
- ç¡¬ç¼–ç å‡­è¯

### 2. æ€§èƒ½å®¡æŸ¥
é‡ç‚¹æ£€æŸ¥ï¼š
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆN+1é—®é¢˜ã€ç¼ºå°‘ç´¢å¼•ï¼‰
- ç®—æ³•å¤æ‚åº¦ï¼ˆæ—¶é—´å’Œç©ºé—´ï¼‰
- å†…å­˜æ³„æ¼é£é™©
- ä¸å¿…è¦çš„è®¡ç®—æˆ–æ¸²æŸ“
- ç½‘ç»œè¯·æ±‚ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥åˆç†æ€§

### 3. ä»£ç è´¨é‡å®¡æŸ¥
é‡ç‚¹æ£€æŸ¥ï¼š
- TypeScriptç±»å‹å®‰å…¨ï¼ˆanyä½¿ç”¨ã€ç±»å‹æ–­è¨€ï¼‰
- ä»£ç é‡å¤åº¦ï¼ˆDRYåŸåˆ™ï¼‰
- å‡½æ•°å¤æ‚åº¦ï¼ˆåœˆå¤æ‚åº¦ > 10ï¼‰
- é”™è¯¯å¤„ç†å®Œæ•´æ€§
- å¼‚æ­¥å¤„ç†æ­£ç¡®æ€§
- èµ„æºç®¡ç†ï¼ˆå…³é—­è¿æ¥ã€é‡Šæ”¾èµ„æºï¼‰

### 4. å¯ç»´æŠ¤æ€§å®¡æŸ¥
é‡ç‚¹æ£€æŸ¥ï¼š
- å•ä¸€èŒè´£åŸåˆ™
- å¼€é—­åŸåˆ™
- ä¾èµ–æ³¨å…¥åˆç†
- é…ç½®å¤–éƒ¨åŒ–
- é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- æ¸…æ™°çš„å‘½å
- åˆç†çš„ä»£ç ç»“æ„

### 5. æµ‹è¯•å®¡æŸ¥
é‡ç‚¹æ£€æŸ¥ï¼š
- æµ‹è¯•è¦†ç›–ç‡
- æµ‹è¯•è´¨é‡ï¼ˆè¾¹ç•Œæ¡ä»¶ã€å¼‚å¸¸æƒ…å†µï¼‰
- æµ‹è¯•çš„å¯ç»´æŠ¤æ€§
- æµ‹è¯•çš„æ€§èƒ½å½±å“

## è¾“å‡ºæ ¼å¼
è¯·è¿”å›JSONæ ¼å¼ï¼š
{
  "summary": {
    "overallAssessment": "æ€»ä½“è¯„ä»·",
    "riskLevel": "é£é™©ç­‰çº§",
    "confidence": 0.95
  },
  "issues": [
    {
      "id": "é—®é¢˜å”¯ä¸€æ ‡è¯†",
      "type": "security|performance|quality|maintainability|test",
      "severity": "critical|high|medium|low|info",
      "description": "è¯¦ç»†é—®é¢˜æè¿°",
      "location": {
        "file": "æ–‡ä»¶è·¯å¾„",
        "line": è¡Œå·,
        "column": åˆ—å·
      },
      "impact": "å¯èƒ½çš„å½±å“",
      "suggestion": "å…·ä½“çš„ä¿®æ”¹å»ºè®®",
      "codeExample": "æ”¹è¿›åçš„ä»£ç ç¤ºä¾‹ï¼ˆå¦‚æœé€‚ç”¨ï¼‰",
      "references": [
        {
          "type": "documentation|article|rule",
          "title": "å‚è€ƒæ ‡é¢˜",
          "url": "å‚è€ƒé“¾æ¥"
        }
      ]
    }
  ],
  "positiveFindings": [
    {
      "aspect": "åšå¾—å¥½çš„æ–¹é¢",
      "description": "å…·ä½“æè¿°",
      "example": "ä»£ç ç¤ºä¾‹"
    }
  ],
  "recommendations": {
    "mustFix": ["å¿…é¡»ä¿®å¤çš„é—®é¢˜IDåˆ—è¡¨"],
    "shouldFix": ["å»ºè®®ä¿®å¤çš„é—®é¢˜IDåˆ—è¡¨"],
    "consider": ["å¯ä»¥è€ƒè™‘çš„æ”¹è¿›IDåˆ—è¡¨"]
  },
  "metrics": {
    "estimatedTimeToFix": "é¢„ä¼°ä¿®å¤æ—¶é—´",
    "complexityScore": "å¤æ‚åº¦è¯„åˆ†",
    "riskScore": "é£é™©è¯„åˆ†"
  }
}

## æ³¨æ„äº‹é¡¹
1. åŒºåˆ†å¿…é¡»ä¿®å¤å’Œå»ºè®®ä¿®å¤çš„é—®é¢˜
2. æä¾›å…·ä½“çš„ä»£ç ç¤ºä¾‹
3. å¼•ç”¨ç›¸å…³çš„ç¼–ç è§„èŒƒæˆ–æœ€ä½³å®è·µ
4. è€ƒè™‘é¡¹ç›®çš„å…·ä½“ä¸Šä¸‹æ–‡
5. ä¿æŒå»ºè®¾æ€§å’Œä¸“ä¸šæ€§
`;
AIå®¡æŸ¥å®ç°ç¤ºä¾‹
typescript
class AICodeReviewer {
  private deepseekService: DeepSeekService;
  private ruleEngine: RuleEngine;
  private metricsCollector: MetricsCollector;
  
  async reviewCode(request: ReviewRequest): Promise<ReviewResult> {
    const startTime = Date.now();
    
    try {
      // 1. è§„åˆ™å¼•æ“æ£€æŸ¥ï¼ˆå¿«é€Ÿã€ç¡®å®šæ€§çš„é—®é¢˜ï¼‰
      const ruleResults = await this.ruleEngine.analyze(request.code);
      
      // 2. AIæ·±åº¦åˆ†æï¼ˆå¤æ‚ã€éœ€è¦ä¸Šä¸‹æ–‡ç†è§£çš„é—®é¢˜ï¼‰
      const aiResults = await this.deepseekReview(request);
      
      // 3. åˆå¹¶ç»“æœ
      const allIssues = [...ruleResults.issues, ...aiResults.issues];
      
      // 4. å»é‡å’Œæ’åº
      const uniqueIssues = this.deduplicateIssues(allIssues);
      const sortedIssues = this.sortIssuesBySeverity(uniqueIssues);
      
      // 5. ç”Ÿæˆç»¼åˆæŠ¥å‘Š
      const report = this.generateReport(
        sortedIssues,
        ruleResults.metrics,
        aiResults.metrics
      );
      
      // 6. è®°å½•æŒ‡æ ‡
      this.metricsCollector.recordReview({
        duration: Date.now() - startTime,
        fileType: request.fileType,
        issuesFound: report.issues.length,
        aiConfidence: aiResults.confidence
      });
      
      return report;
      
    } catch (error) {
      // é™çº§åˆ°è§„åˆ™å¼•æ“
      const fallbackResults = await this.ruleEngine.analyze(request.code);
      
      return {
        issues: fallbackResults.issues,
        summary: {
          overallAssessment: 'AIå®¡æŸ¥å¤±è´¥ï¼Œä½¿ç”¨è§„åˆ™å¼•æ“ç»“æœ',
          riskLevel: 'medium',
          confidence: 0.7
        },
        metrics: {
          aiFailed: true,
          error: error.message
        }
      };
    }
  }
  
  private async deepseekReview(request: ReviewRequest): Promise<AIReviewResult> {
    // æ„å»ºæç¤ºè¯
    const prompt = this.buildReviewPrompt(request);
    
    // è°ƒç”¨AIæœåŠ¡
    const response = await this.deepseekService.callApi<AIReviewResult>(prompt, {
      model: 'deepseek-chat',
      temperature: 0.1, // ä½æ¸©åº¦ï¼Œç¡®ä¿å®¡æŸ¥ä¸¥è°¨æ€§
      maxTokens: 4000,
      useCache: true,
      cacheKey: this.generateCacheKey(request)
    });
    
    // éªŒè¯AIå“åº”
    this.validateAIResponse(response);
    
    return response;
  }
  
  private buildReviewPrompt(request: ReviewRequest): string {
    const template = `
# ä»£ç å®¡æŸ¥è¯·æ±‚

## ä»£ç ä¿¡æ¯
æ–‡ä»¶è·¯å¾„ï¼š${request.filePath}
æ–‡ä»¶ç±»å‹ï¼š${request.fileType}
ä»£ç ç‰‡æ®µï¼š
\`\`\`${request.language}
${request.code}
\`\`\`

## ä¸Šä¸‹æ–‡ä¿¡æ¯
- é¡¹ç›®ï¼šæ™ºèƒ½è®°è´¦åŠ©æ‰‹
- æŠ€æœ¯æ ˆï¼š${JSON.stringify(request.techStack)}
- ç›¸å…³ä¿®æ”¹ï¼š${request.relatedChanges || 'æ— '}
- ä»£ç ç›®çš„ï¼š${request.purpose}

## å®¡æŸ¥é‡ç‚¹
è¯·ç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
${request.focusAreas?.map(area => `- ${area}`).join('\n')}

## å·²çŸ¥é—®é¢˜
${request.knownIssues?.map(issue => `- ${issue}`).join('\n') || 'æ— '}

## å®¡æŸ¥æ·±åº¦
${request.depth === 'deep' ? 'è¿›è¡Œæ·±åº¦å®¡æŸ¥ï¼ŒåŒ…æ‹¬æ½œåœ¨çš„ä¼˜åŒ–å»ºè®®' : 'è¿›è¡Œå¸¸è§„å®¡æŸ¥'}
    `;
    
    return template;
  }
}
3. å…·ä½“å®¡æŸ¥è¦ç‚¹ç¤ºä¾‹
3.1 å®‰å…¨æ€§å®¡æŸ¥ç»†èŠ‚
typescript
// å¸¸è§å®‰å…¨é—®é¢˜æ£€æŸ¥ç¤ºä¾‹
class SecurityReviewer {
  
  async checkSqlInjection(code: string): Promise<SecurityIssue[]> {
    const issues: SecurityIssue[] = [];
    
    // æ£€æŸ¥å­—ç¬¦ä¸²æ‹¼æ¥çš„SQL
    const sqlPatterns = [
      /execute\(.*\+.*\)/g,
      /query\(.*\$\{.*\}.*\)/g,
      /`SELECT.*\$\{.*\}`/g
    ];
    
    for (const pattern of sqlPatterns) {
      const matches = code.matchAll(pattern);
      for (const match of matches) {
        issues.push({
          type: 'security',
          severity: 'critical',
          description: 'æ½œåœ¨çš„SQLæ³¨å…¥æ¼æ´',
          location: this.getLocation(code, match.index!),
          suggestion: 'ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–ORMæä¾›çš„å®‰å…¨æ–¹æ³•',
          example: {
            bad: 'connection.query(`SELECT * FROM users WHERE id = ${id}`)',
            good: 'connection.query("SELECT * FROM users WHERE id = ?", [id])'
          }
        });
      }
    }
    
    return issues;
  }
  
  async checkXssVulnerabilities(code: string): Promise<SecurityIssue[]> {
    const issues: SecurityIssue[] = [];
    
    // æ£€æŸ¥Reactä¸­çš„XSSé£é™©
    const dangerousPatterns = [
      {
        pattern: /dangerouslySetInnerHTML/g,
        description: 'ä½¿ç”¨dangerouslySetInnerHTMLå¯èƒ½å¯¼è‡´XSS',
        suggestion: 'ä½¿ç”¨å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¦‚textContentæˆ–ç»è¿‡æ¸…ç†çš„HTML'
      },
      {
        pattern: /innerHTML\s*=/g,
        description: 'ç›´æ¥è®¾ç½®innerHTMLå¯èƒ½å¯¼è‡´XSS',
        suggestion: 'ä½¿ç”¨textContentæˆ–DOMPurifyæ¸…ç†HTML'
      },
      {
        pattern: /eval\(/g,
        description: 'ä½¿ç”¨evalå‡½æ•°å¯èƒ½å¯¼è‡´ä»£ç æ³¨å…¥',
        suggestion: 'é¿å…ä½¿ç”¨evalï¼Œä½¿ç”¨JSON.parseæˆ–Functionæ„é€ å‡½æ•°ï¼ˆå¦‚æœéœ€è¦ï¼‰'
      }
    ];
    
    for (const check of dangerousPatterns) {
      if (check.pattern.test(code)) {
        issues.push({
          type: 'security',
          severity: 'high',
          description: check.description,
          location: this.getLocation(code, code.search(check.pattern)),
          suggestion: check.suggestion
        });
      }
    }
    
    return issues;
  }
  
  async checkSensitiveDataExposure(code: string): Promise<SecurityIssue[]> {
    const issues: SecurityIssue[] = [];
    
    // æ£€æŸ¥ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
    const sensitivePatterns = [
      { pattern: /password\s*=\s*["'].*["']/, type: 'ç¡¬ç¼–ç å¯†ç ' },
      { pattern: /api[Kk]ey\s*=\s*["'].*["']/, type: 'ç¡¬ç¼–ç APIå¯†é’¥' },
      { pattern: /secret\s*=\s*["'].*["']/, type: 'ç¡¬ç¼–ç å¯†é’¥' },
      { pattern: /token\s*=\s*["'].*["']/, type: 'ç¡¬ç¼–ç ä»¤ç‰Œ' },
      { pattern: /private[Kk]ey\s*=\s*["'].*["']/, type: 'ç¡¬ç¼–ç ç§é’¥' }
    ];
    
    for (const sensitive of sensitivePatterns) {
      const matches = code.matchAll(sensitive.pattern);
      for (const match of matches) {
        issues.push({
          type: 'security',
          severity: 'critical',
          description: `å‘ç°${sensitive.type}`,
          location: this.getLocation(code, match.index!),
          suggestion: 'å°†æ•æ„Ÿä¿¡æ¯ç§»åˆ°ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­',
          example: {
            bad: 'const apiKey = "sk-1234567890abcdef"',
            good: 'const apiKey = process.env.API_KEY'
          }
        });
      }
    }
    
    return issues;
  }
}
3.2 æ€§èƒ½å®¡æŸ¥ç»†èŠ‚
typescript
class PerformanceReviewer {
  
  async checkDatabaseQueries(code: string): Promise<PerformanceIssue[]> {
    const issues: PerformanceIssue[] = [];
    
    // æ£€æŸ¥N+1æŸ¥è¯¢é—®é¢˜
    const nPlusOnePatterns = [
      {
        pattern: /for.*of.*\.map.*await.*find/g,
        description: 'å¯èƒ½çš„N+1æŸ¥è¯¢é—®é¢˜',
        suggestion: 'ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢æˆ–å…³è”é¢„åŠ è½½'
      },
      {
        pattern: /\.forEach.*await.*find/g,
        description: 'å¾ªç¯å†…çš„æ•°æ®åº“æŸ¥è¯¢',
        suggestion: 'å°†æŸ¥è¯¢ç§»åˆ°å¾ªç¯å¤–ï¼Œä½¿ç”¨æ‰¹é‡æ“ä½œ'
      }
    ];
    
    for (const check of nPlusOnePatterns) {
      if (check.pattern.test(code)) {
        issues.push({
          type: 'performance',
          severity: 'high',
          description: check.description,
          location: this.getLocation(code, code.search(check.pattern)),
          suggestion: check.suggestion,
          example: {
            bad: `users.forEach(async user => {
  const orders = await Order.find({ userId: user.id });
})`,
            good: `const userIds = users.map(u => u.id);
const allOrders = await Order.find({ userId: { $in: userIds } });`
          }
        });
      }
    }
    
    return issues;
  }
  
  async checkMemoryLeaks(code: string): Promise<PerformanceIssue[]> {
    const issues: PerformanceIssue[] = [];
    
    // æ£€æŸ¥å¸¸è§çš„å†…å­˜æ³„æ¼æ¨¡å¼
    const leakPatterns = [
      {
        pattern: /setInterval.*=>/g,
        description: 'æœªæ¸…ç†çš„setIntervalå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼',
        suggestion: 'åœ¨ç»„ä»¶å¸è½½æˆ–ä¸å†éœ€è¦æ—¶æ¸…é™¤interval'
      },
      {
        pattern: /addEventListener.*=>.*removeEventListener/g,
        description: 'äº‹ä»¶ç›‘å¬å™¨æœªæ­£ç¡®ç§»é™¤',
        suggestion: 'ç¡®ä¿æ¯ä¸ªaddEventListeneréƒ½æœ‰å¯¹åº”çš„removeEventListener'
      },
      {
        pattern: /new Promise.*resolve.*reject/g,
        description: 'æœªå¤„ç†çš„Promiseå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼',
        suggestion: 'æ€»æ˜¯å¤„ç†Promiseçš„æ‹’ç»æƒ…å†µ'
      }
    ];
    
    for (const check of leakPatterns) {
      const matches = code.matchAll(check.pattern);
      for (const match of matches) {
        issues.push({
          type: 'performance',
          severity: 'medium',
          description: check.description,
          location: this.getLocation(code, match.index!),
          suggestion: check.suggestion,
          example: {
            bad: `useEffect(() => {
  const interval = setInterval(() => {
    // ä¸€äº›æ“ä½œ
  }, 1000);
  // ç¼ºå°‘æ¸…ç†
}, []);`,
            good: `useEffect(() => {
  const interval = setInterval(() => {
    // ä¸€äº›æ“ä½œ
  }, 1000);
  return () => clearInterval(interval);
}, []);`
          }
        });
      }
    }
    
    return issues;
  }
  
  async checkAlgorithmComplexity(code: string): Promise<PerformanceIssue[]> {
    const issues: PerformanceIssue[] = [];
    
    // æ£€æŸ¥é«˜å¤æ‚åº¦ç®—æ³•
    const complexityPatterns = [
      {
        pattern: /for.*for.*for/g,
        description: 'ä¸‰å±‚åµŒå¥—å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦O(nÂ³)',
        suggestion: 'è€ƒè™‘ä¼˜åŒ–ç®—æ³•ï¼Œé™ä½å¤æ‚åº¦'
      },
      {
        pattern: /\.sort\(.*\)\.filter\(.*\)\.map\(.*\)\.reduce/g,
        description: 'è¿ç»­çš„æ•°æ®è½¬æ¢å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜',
        suggestion: 'åˆå¹¶æ“ä½œæˆ–ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„'
      }
    ];
    
    for (const check of complexityPatterns) {
      if (check.pattern.test(code)) {
        issues.push({
          type: 'performance',
          severity: 'medium',
          description: check.description,
          location: this.getLocation(code, code.search(check.pattern)),
          suggestion: check.suggestion
        });
      }
    }
    
    return issues;
  }
}
3.3 ä»£ç è´¨é‡å®¡æŸ¥ç»†èŠ‚
typescript
class CodeQualityReviewer {
  
  async checkTypeScriptSafety(code: string): Promise<QualityIssue[]> {
    const issues: QualityIssue[] = [];
    
    // æ£€æŸ¥TypeScriptç±»å‹å®‰å…¨é—®é¢˜
    const typeSafetyPatterns = [
      {
        pattern: /as any/g,
        description: 'ä½¿ç”¨ç±»å‹æ–­è¨€any',
        suggestion: 'ä½¿ç”¨æ›´å…·ä½“çš„ç±»å‹æˆ–æ³›å‹'
      },
      {
        pattern: /:\s*any\s*(?!=)/g,
        description: 'ä½¿ç”¨anyç±»å‹',
        suggestion: 'ä½¿ç”¨unknownæˆ–æ›´å…·ä½“çš„ç±»å‹'
      },
      {
        pattern: /!\s*;/g,
        description: 'ä½¿ç”¨éç©ºæ–­è¨€æ“ä½œç¬¦',
        suggestion: 'æ·»åŠ ç©ºå€¼æ£€æŸ¥æˆ–ä½¿ç”¨å¯é€‰é“¾'
      }
    ];
    
    for (const check of typeSafetyPatterns) {
      const matches = code.matchAll(check.pattern);
      for (const match of matches) {
        issues.push({
          type: 'quality',
          severity: 'medium',
          description: check.description,
          location: this.getLocation(code, match.index!),
          suggestion: check.suggestion,
          example: {
            bad: 'const data = response.data as any;',
            good: 'const data = response.data as UserData;'
          }
        });
      }
    }
    
    return issues;
  }
  
  async checkCodeDuplication(code: string, context?: CodeContext): Promise<QualityIssue[]> {
    const issues: QualityIssue[] = [];
    
    // ä½¿ç”¨ASTåˆ†æä»£ç é‡å¤
    const ast = this.parseToAST(code);
    const duplicates = this.findDuplicateCodeBlocks(ast);
    
    for (const duplicate of duplicates) {
      if (duplicate.similarity > 0.8) {
        issues.push({
          type: 'quality',
          severity: 'medium',
          description: `å‘ç°é‡å¤ä»£ç ï¼Œç›¸ä¼¼åº¦${Math.round(duplicate.similarity * 100)}%`,
          location: duplicate.locations[0],
          suggestion: 'æå–å…¬å…±å‡½æ•°æˆ–ç»„ä»¶',
          references: duplicate.locations.slice(1)
        });
      }
    }
    
    return issues;
  }
  
  async checkErrorHandling(code: string): Promise<QualityIssue[]> {
    const issues: QualityIssue[] = [];
    
    // æ£€æŸ¥é”™è¯¯å¤„ç†å®Œæ•´æ€§
    const errorHandlingPatterns = [
      {
        pattern: /try\s*{[\s\S]*?\}\s*catch\s*\(\s*\)/g,
        description: 'ç©ºçš„catchå—',
        suggestion: 'åœ¨catchå—ä¸­å¤„ç†é”™è¯¯æˆ–è®°å½•æ—¥å¿—'
      },
      {
        pattern: /async.*=>.*\{[^}]*await[^}]*\}(?!\s*catch)/g,
        description: 'å¼‚æ­¥å‡½æ•°ç¼ºå°‘é”™è¯¯å¤„ç†',
        suggestion: 'æ·»åŠ try-catchæˆ–.catch()å¤„ç†é”™è¯¯'
      },
      {
        pattern: /throw new Error\(["'][^"']*["']\)/g,
        description: 'æŠ›å‡ºé€šç”¨é”™è¯¯',
        suggestion: 'ä½¿ç”¨å…·ä½“çš„é”™è¯¯ç±»å‹ï¼Œæä¾›æ›´å¤šä¸Šä¸‹æ–‡'
      }
    ];
    
    for (const check of errorHandlingPatterns) {
      const matches = code.matchAll(check.pattern);
      for (const match of matches) {
        issues.push({
          type: 'quality',
          severity: 'medium',
          description: check.description,
          location: this.getLocation(code, match.index!),
          suggestion: check.suggestion,
          example: {
            bad: `try {
  await someAsyncOperation();
} catch {}`,
            good: `try {
  await someAsyncOperation();
} catch (error) {
  logger.error('æ“ä½œå¤±è´¥', error);
  throw new OperationError('æ“ä½œå¤±è´¥', { cause: error });
}`
          }
        });
      }
    }
    
    return issues;
  }
}
4. ä»£ç å®¡æŸ¥æŠ¥å‘Šæ¨¡æ¿
typescript
interface CodeReviewReport {
  // åŸºæœ¬ä¿¡æ¯
  metadata: {
    reviewId: string;
    reviewDate: string;
    reviewer: string; // äººæˆ–AI
    filePath: string;
    commitHash: string;
    timeSpent: number; // åˆ†é’Ÿ
  };
  
  // å®¡æŸ¥ç»“æœæ¦‚è§ˆ
  summary: {
    overallStatus: 'approved' | 'changes_requested' | 'blocked';
    riskLevel: 'low' | 'medium' | 'high' | 'critical';
    confidenceScore: number; // 0-1ï¼ŒAIå®¡æŸ¥çš„ç½®ä¿¡åº¦
    statistics: {
      totalIssues: number;
      criticalIssues: number;
      highIssues: number;
      mediumIssues: number;
      lowIssues: number;
      securityIssues: number;
      performanceIssues: number;
      qualityIssues: number;
    };
  };
  
  // è¯¦ç»†é—®é¢˜åˆ—è¡¨
  issues: Array<{
    id: string;
    type: 'security' | 'performance' | 'quality' | 'maintainability' | 'test';
    severity: 'critical' | 'high' | 'medium' | 'low' | 'info';
    status: 'open' | 'resolved' | 'won\'t_fix';
    title: string;
    description: string;
    
    // ä½ç½®ä¿¡æ¯
    location: {
      file: string;
      line: number;
      column?: number;
      codeSnippet: string;
    };
    
    // å½±å“åˆ†æ
    impact: {
      description: string;
      probability: 'low' | 'medium' | 'high';
      businessImpact: 'low' | 'medium' | 'high';
      userImpact: string;
    };
    
    // å»ºè®®
    suggestion: string;
    codeExample?: {
      before: string;
      after: string;
    };
    
    // å‚è€ƒ
    references?: Array<{
      type: 'documentation' | 'article' | 'rule';
      title: string;
      url: string;
    }>;
    
    // å¤„ç†
    assignedTo?: string;
    dueDate?: string;
    resolution?: string;
  }>;
  
  // æ­£é¢åé¦ˆ
  positiveAspects: Array<{
    aspect: string;
    description: string;
    codeExample: string;
  }>;
  
  // æ”¹è¿›å»ºè®®
  recommendations: {
    immediateActions: string[];
    shortTermImprovements: string[];
    longTermConsiderations: string[];
  };
  
  // æŒ‡æ ‡å’Œå»ºè®®
  metrics: {
    estimatedFixTime: number; // å°æ—¶
    complexityScore: number; // 0-100
    maintainabilityIndex: number; // 0-100
    testCoverage: number; // ç™¾åˆ†æ¯”
    
    // AIç‰¹å®šæŒ‡æ ‡
    aiMetrics?: {
      modelUsed: string;
      confidence: number;
      processingTime: number;
      cacheHit: boolean;
    };
  };
  
  // å®¡æŸ¥ç»“è®º
  conclusion: {
    canMerge: boolean;
    mergeConditions: string[];
    nextSteps: string[];
    reviewComplete: boolean;
  };
}

// æŠ¥å‘Šç”Ÿæˆå™¨
class ReviewReportGenerator {
  async generateReport(
    issues: ReviewIssue[],
    metrics: ReviewMetrics,
    context: ReviewContext
  ): Promise<CodeReviewReport> {
    
    // åˆ†æç»Ÿè®¡æ•°æ®
    const stats = this.calculateStatistics(issues);
    
    // ç¡®å®šæ€»ä½“çŠ¶æ€
    const overallStatus = this.determineOverallStatus(issues);
    
    // è¯„ä¼°é£é™©ç­‰çº§
    const riskLevel = this.calculateRiskLevel(issues, context);
    
    // ç”ŸæˆæŠ¥å‘Š
    return {
      metadata: {
        reviewId: uuid(),
        reviewDate: new Date().toISOString(),
        reviewer: context.reviewer || 'AI Assistant',
        filePath: context.filePath,
        commitHash: context.commitHash,
        timeSpent: metrics.timeSpent
      },
      summary: {
        overallStatus,
        riskLevel,
        confidenceScore: metrics.confidence || 0.8,
        statistics: stats
      },
      issues: this.formatIssues(issues),
      positiveAspects: this.extractPositiveAspects(issues, context),
      recommendations: this.generateRecommendations(issues, context),
      metrics: {
        estimatedFixTime: this.estimateFixTime(issues),
        complexityScore: this.calculateComplexityScore(context.code),
        maintainabilityIndex: this.calculateMaintainabilityIndex(context.code),
        testCoverage: context.testCoverage || 0
      },
      conclusion: {
        canMerge: overallStatus === 'approved',
        mergeConditions: this.getMergeConditions(issues),
        nextSteps: this.getNextSteps(issues, context),
        reviewComplete: true
      }
    };
  }
}
5. é›†æˆåˆ°å¼€å‘æµç¨‹
yaml
# .github/workflows/code-review.yml
name: Code Review Automation

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [main, develop]

jobs:
  automated-review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run static analysis
        run: npm run lint
        
      - name: Run security scan
        uses: snyk/actions/node@master
        with:
          args: --severity-threshold=high
        
      - name: Run tests with coverage
        run: npm run test:coverage
        
      - name: AI Code Review
        if: always()
        uses: your-org/ai-code-review-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          openai_key: ${{ secrets.OPENAI_KEY }}
          config_path: .aicodereview.yaml
        
      - name: Generate Review Report
        if: always()
        run: npm run review:report
        
      - name: Upload Review Report
        uses: actions/upload-artifact@v3
        with:
          name: code-review-report
          path: review-report.json
          
  human-review:
    needs: [automated-review]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Check Review Results
        uses: your-org/review-gate@v1
        with:
          required-checks: |
            lint
            security-scan
            test-coverage
            ai-review
          min-approvals: 2
          allowed-reviewers: team-leads,senior-developers
          
      - name: Notify Reviewers
        if: failure()
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'âš ï¸ ä»£ç å®¡æŸ¥æœªé€šè¿‡ï¼Œè¯·æŸ¥çœ‹è‡ªåŠ¨åŒ–æ£€æŸ¥ç»“æœå¹¶å¤„ç†å‘ç°çš„é—®é¢˜ã€‚'
            })#   s m a r t - f i n a n c e - a s s i s t a n t  
 